angular.module("anGrid.directives",["anGrid.services","anGrid.filters","ngSanitize"],["$compileProvider",function(e){e.directive("angrid",["$compile","widthServices","setDefaultOption",function(e,t,n){var o={transclude:!0,scope:!0,controller:["$scope","$element","$attrs",function(e,o,a){var i=this;e.option=e.$eval(a.angrid),this.config=n(e.option),t(e.option.columnDefs),e.option.angridStyle=this.config.angridStyle,e.option.canSelectRows=this.config.canSelectRows,e.option.multiSelect=this.config.multiSelect,e.option.displaySelectionCheckbox=this.config.displaySelectionCheckbox,e.option.selectWithCheckboxOnly=this.config.selectWithCheckboxOnly,e.option.multiSelectWithCheckbox=this.config.multiSelectWithCheckbox,e.option.columnDefs=this.config.columnDefs,e.option.enableSorting=this.config.enableSorting,e.option.selectedItems=this.config.selectedItems,e.option.searchFilter=this.config.searchFilter,e.option.searchHighlight=this.config.searchHighlight,e.option.searchHighlight=this.config.caseSensitive,e.option.showFooter=this.config.showFooter,e.option._orderByPredicate=this.config._orderByPredicate,e.option._orderByreverse=this.config._orderByreverse,e.angrid={},e.angrid.hasFooterClass=e.option.showFooter?"hasFooter":"";var r=0,c=function(t){"string"==typeof e.option.data&&(r=t?t.length:0,e.thedata=e.$eval(e.option.data)||[],i.config.data=e.thedata)};e.$parent.$watch(e.option.data,c),e.$parent.$watch(e.option.data+".length",function(t){t!=r&&c(e.$eval(e.option.data))}),e.$on("anrowData change",function(){console.log("row change")})}],template:'<div class="anGrid instance {{option.angridStyle}}"><div class="anHead"><!-- thead --><ul><anhead sort-field="option._orderByPredicate" sort-reverse="option._orderByreverse" selects="option.selectedItems"></anhead></ul></div><div class="anBody {{angrid.hasFooterClass}}"><!-- tbody --><ul><anrow ng-repeat="rowdata in thedata | orderBy:option._orderByPredicate:option._orderByreverse | filter:search" anrow-data="rowdata" selects="option.selectedItems" search-filter="option.searchFilter" ></anrow></ul></div><div class="anFooter" ng-show="option.showFooter"><div class="btn-group filter"><input id="inputIcon" type="text" ng-model="option.searchFilter" /><i class="icon-search"></i></div></div><div class="expression">{{ search.$ = option.searchFilter }}</div></div>',replace:!0};return o}]),e.directive("anrow",["$compile",function(e){return{require:"^angrid",restrict:"E",transclude:!0,scope:{anrowData:"=anrowData",selectedItems:"=selects",searchFilter:"=searchFilter"},template:'<li ng-click="anrow.toggleSelectedFuc($event)" ng-class="anrow.rowCssClassFuc()" ng-mouseenter="anrow.hovered=true" ng-mouseleave="anrow.hovered=false" ></li>',replace:!0,link:function(t,n,o,a){t.anrowColumns=a.config.columnDefs,t.anrowData.selected=!1,t.anrow=angular.extend({hovered:!1,rowCssClassFuc:function(){var e="";if(void 0!==typeof t.anrowData.selected)return e=t.anrowData.selected?"selected":"",e+=this.hovered?" hover":""},checkboxClassFuc:function(){return void 0!==typeof t.anrowData.selected?t.anrowData.selected?"dijitCheckBox dijitCheckBoxChecked":"dijitCheckBox":void 0},multiSelectFuc:function(){if(t.anrowData.selected){t.anrowData.selected=!1;var e=a.config.selectedItems;t.selectedItems=[],angular.forEach(e,function(e){e.selected&&t.selectedItems.push(e)})}else t.anrowData.selected=!0,t.selectedItems.push(t.anrowData)},singleSelectFuc:function(){t.anrowData.selected?t.selectedItems.length>1?(angular.forEach(a.config.data,function(e){e.selected=!1}),t.selectedItems=[],t.anrowData.selected=!0,t.selectedItems.push(t.anrowData)):(t.anrowData.selected=!1,t.selectedItems=[]):(angular.forEach(a.config.data,function(e){e.selected=!1}),t.anrowData.selected=!0,t.selectedItems=[],t.selectedItems.push(t.anrowData))},toggleSelectedFuc:function(e){a.config.canSelectRows&&void 0!==typeof t.anrowData.selected&&(a.config.selectWithCheckboxOnly&&"checkbox"!=e.target.dir||(a.config.multiSelect?a.config.multiSelectWithCheckbox===!0&&"checkbox"!=e.target.dir?this.singleSelectFuc():this.multiSelectFuc():this.singleSelectFuc()))}},t.anrow);var i=a.config.displaySelectionCheckbox===!0?'<div class="anCheckbox"><span dir="checkbox" ng-class="anrow.checkboxClassFuc()"></span></div>':"",r=i+'<ol class="clearfix">'+'<ancell ng-repeat="col in anrowColumns" row-data="anrowData" col-data="col" search-filter="searchFilter"></ancell>'+"</ol>";n.append(e(r)(t))}}}]),e.directive("ancell",["$compile","$filter",function(e,t){return{require:"^angrid",restrict:"E",transclude:!0,scope:{rowData:"=rowData",colData:"=colData",searchFilter:"=searchFilter"},template:'<li class="{{colData.cssClass}}" ng-style="colData._style" title="{{title}}"></li>',replace:!0,link:function(n,o,a,i){if(""!==n.colData.columnFilter){var r=t(n.colData.columnFilter);n.title=r(n.rowData[n.colData.field])}else n.title=n.rowData[n.colData.field];n.caseSensitive=i.config.caseSensitive;var c=""===n.colData.columnFilter?"":" | "+n.colData.columnFilter,s=""===c?'<span ng-bind-html-unsafe="rowData[colData.field] | highlight:searchFilter:caseSensitive"></span>':'<span ng-bind-html="rowData[colData.field]'+c+'"></span>';s=n.colData.columnTemplete?n.colData.columnTemplete:s,o.append(e(s)(n))}}}]),e.directive("anhead",["$compile",function(e){return{require:"^angrid",restrict:"E",transclude:!0,template:"<li></li>",replace:!0,scope:{sortfield:"=sortField",sortreverse:"=sortReverse",selectedItems:"=selects"},link:function(t,n,o,a){t.anhead=angular.extend({selectAll:!1,columnDefs:a.config.columnDefs,toggleSelectAllFuc:function(){a.config.canSelectRows&&a.config.displaySelectionCheckbox&&(t.selectedItems=[],this.selectAll?(this.selectAll=!1,angular.forEach(a.config.data,function(e){e.selected=!1})):(this.selectAll=!0,angular.forEach(a.config.data,function(e){e.selected=!0,t.selectedItems.push(e)})))},sortFuc:function(e){a.config.enableSorting&&e.sortable&&(angular.forEach(this.columnDefs,function(e){e._sortIconflag=!1}),e._sortIconflag=!0,t.sortfield=e.field,t.sortreverse=!t.sortreverse,t.caret=t.sortreverse?"caretdown":"caretup")},headCellCssFuc:function(e){var t=e.sortable===!0?"sortable ":" ";return t+=e.cssClass}},t.anhead);var i=a.config.displaySelectionCheckbox===!0?'<div class="anCheckbox" ng-click="anhead.toggleSelectAllFuc()"><span class="dijitCheckBox" ng-class="{\'dijitCheckBoxChecked\': anhead.selectAll}"></span></div>':"",r=i+"<ol>"+'<li ng-repeat="col in anhead.columnDefs" ng-class="anhead.headCellCssFuc(col)"  ng-class="{\'sortable\': col.sortable}" ng-style="{{col._style}}" ng-click="anhead.sortFuc(col)">{{col.displayName|i18n}}<span ng-class="caret" ng-show="col._sortIconflag"></span></li>'+"</ol>";n.append(e(r)(t))}}}])}]),angular.module("anGrid.services",[]).factory("setDefaultOption",function(){return function(e){return angular.forEach(e.columnDefs,function(t,n){t=angular.extend({field:"",displayName:this.field,cssClass:"",width:"",sortable:!0,columnFilter:"",columnTemplete:!1,_sortIconflag:!1,_style:""},t),e.columnDefs.splice(n,1,t)}),e=angular.extend({angridStyle:"th-list",canSelectRows:!0,multiSelect:!0,displaySelectionCheckbox:!0,selectWithCheckboxOnly:!1,multiSelectWithCheckbox:!1,columnDefs:[],enableSorting:!0,selectedItems:[],searchFilter:"",searchHighlight:!1,caseSensitive:!0,showFooter:!1,_orderByPredicate:"",_orderByreverse:!1},e)}}).factory("widthServices",function(){return function(e){var t=0,n="";angular.forEach(e,function(o,a){var i=parseFloat(o.width);if(isNaN(i)){if(""===o.cssClass){if(""!==o.width&&"auto"!==o.width)throw'you would better use percentage ("10%","20%", etc...) to use remaining width of grid';var r=100-t,c="%"==n?r/(e.length-a):100/e.length;o._style={left:t+"%",width:c+"%"},t+=c}}else{var s=o.width.substr((""+i).length);if(s=""===s?"px":s,n=0===a?s:n,s!=n)throw'you must set the same util of width, you would better use percentage ("10%","20%", etc...)';o.style={left:t+s,width:o.width},t+=i}})}}),angular.module("anGrid.filters",[]).filter("tostring",function(){return function(e){switch(typeof e){case"undefined":return"undefined";case"function":return e();default:return null===e?"null":""+e}}}).filter("checkmark",function(){return function(e){return e?"✔":"✘"}}).filter("reverse",function(){return function(e,t){for(var n="",o=0;e.length>o;o++)n=e.charAt(o)+n;return t&&(n=n.toUpperCase()),n}}).filter("highlight",function(){return function(e,t,n){return t||angular.isNumber(t)?(e=""+e,t=""+t,n?e.split(t).join('<span class="ui-match">'+t+"</span>"):e.replace(RegExp(t,"gi"),'<span class="ui-match">$&</span>')):"boolean"==typeof e?""+e:e}}),angular.module("anGrid",["anGrid.services","anGrid.directives","anGrid.filters"]),angular.module("RestService",["ngResource","AppService"]).factory("ApiResource",function(){return{enabled_panels:{list:"/resource/panels"},region:{list:"/resource/region/list"},quota:{list:"/resource/quota/list"},instance:{list:"/resource/instance/list",detail:"/resource/instance/detail/:id",console:"/resource/instance/console/",vnc:"/resource/instance/vnc/"},vm_usage:{detail:"/resource/vm_usage/detail/:id"},volume:{list:"/resource/volume/list",detail:"/resource/volume/detail/:id"},flavor:{list:"/resource/flavor/list",detail:"/resource/flavor/detail/:id"},image:{list:"/resource/image/list",detail:"/resource/image/detail/:id"},snapshot:{list:"/resource/snapshot/list",detail:"/resource/snapshot/detail/:id"},security_group:{list:"/resource/security_group/list",detail:"/resource/security_group/detail/:id"},keypair:{list:"/resource/keypair/list",detail:"/resource/keypair/detail/:id",create_keypair:"/resource/keypair/create"},floating_ip:{list:"/resource/floating_ip/list",detail:"/resource/floating_ip/detail/:id",list_pool:"/resource/floating_ip/list_pool"},load_balancer:{list:"/resource/load_balancer/list",detail:"/resource/load_balancer/detail/:id"},coupon_code:{list:"/resource/coupon/code_list"},coupon_log:{list:"/resource/coupon/log_list",remaining:"/resource/coupon/coupon_remaining"},user_crash:{list:"/resource/crash/crash_monthly_log",detail:"/resource/crash/crash_monthly_detail/:id",remaining:"/resource/crash/crash_remaining"},volume_type:{list:"/resource/volume_type/list",detail:"/resource/volume_type/detail/:id"},volume_snapshot:{list:"/resource/volume_snapshot/list",detail:"/resource/volume_snapshot/detail/:id"},admin_node:{list:"/resource/node/list",detail:"/resource/node/detail/:id"},admin_instance:{list:"/resource/instance/list"},admin_service:{list:"/resource/service/list"},admin_project:{list:"/resource/project/list",detail:"/resource/project/detail/:id"},admin_user:{list:"/resource/user/list",detail:"/resource/user/detail/:id"},admin_quota:{list:"/resource/quota/list"},admin_coupon:{code_list:"/resource/coupon/code_list"},admin_apply_code:{list:"/resource/apply_code/list",detail:"/resource/apply_code/detail/:id"}}}).factory("BaseResource",["$resource","$http","$cookies","ApiResource",function(e,t,n,o){return function(a){var i,r,c;return t.defaults.headers.common["X-CSRFToken"]=n.csrftoken,t.defaults.headers.common["Content-Type"]="application/json;charset=utf-8",i=o[a],r=e(i.list,{},{save_list:{method:"POST",isArray:!0}}),c=e(i.detail,{id:"@id"},{update:{method:"PUT"},action:{method:"PUT"}}),c.remove=function(e,t,n){this.delete({id:e},function(){n&&n.delay_delete?t&&t():r._delete(e)})},c.update_data=function(e,t,n,o){t.id=e,this.update(t,function(t){if(!o)return n&&n(t),r._update_cache(e,t),void 0;var a=o.refresh;return a?(c.get({id:e},function(t){n&&n(),r._update_cache(e,t)}),void 0):void 0})},r.cache=null,r.fetching=!1,r._tmp_callbacks=[],r._update_cache=function(e,t){var n;n=this._get_by_uuid(e,!0).index,void 0==t?this.cache.splice(n,1):this.cache[n]=t},r._get_by_uuid=function(e,t){if(1==t){for(var n=0;this.cache.length>n;n++)if(this.cache[n]&&this.cache[n].id==e)return{item:t[n],index:n};return{item:null,index:null}}var o;return o=c.get({id:e}),this._update_cache(e,o),{item:item,index:null}},r.fetch=function(e,t){e=void 0===e?{}:e;var n=e.from_cache;void 0===n&&(n=2),delete e.from_cache;var o=e.no_update_cache;switch(void 0!==o&&delete e.no_update_cache,n){case 0:return"function"==typeof t&&t(this.cache),this.cache;case 1:var a=this;return a.fetching=!0,null==a.cache&&(a.cache=[]),this.query(e,function(e){if(o);else{a.cache.splice(0,a.cache.length);for(var n=0;e.length>n;n++)a.cache.push(e[n])}if(a.fetching=!1,"function"==typeof t&&t(a.cache,e),0!=a._tmp_callbacks.length){var i=a._tmp_callbacks.splice(0);for(var n in i)"function"==typeof i[n]&&i[n](a.cache,e)}},function(e){(403==e.status||401==e.status.status)&&window.location.reload()}),a.cache;case 2:return null===this.cache||this.fetching?this.fetching?(this._tmp_callbacks.push(t),this.cache):(e.from_cache=1,this.fetch(e,t)):(e.from_cache=0,this.fetch(e,t))}},r._delete=function(e){var t=this._get_by_uuid(e,!0).index;return void 0!==t?this.cache.splice(t,1):null},r.create=function(e,t,n){var o=function(e){"function"==typeof n&&n(e)},a=function(){r.save(e,function(e){r.cache.push(e),o(e)})};if(t){if(t.multi)this.save_list(e,function(e){for(var t=0;e.length>t;t++)r.cache.push(e[t]);o(e)});else if(t.refresh_based_on_count){var i=e.count;return 1==i?a():r.save(e,function(){r.fetch({from_cache:1},o)}),void 0}}else a()},{list_resource:r,detail_resource:c}}}]).factory("CouponCodeResource",["BaseResource",function(e){var t=new e("coupon_code");return{list_resource:t.list_resource}}]).factory("CouponLogResource",["$resource","ApiResource","BaseResource",function(e,t,n){var o=new n("coupon_log");return o.remaining_resource=e(t.coupon_log.remaining),{list_resource:o.list_resource,remaining_resource:o.remaining_resource}}]).factory("CrashResource",["$resource","ApiResource","BaseResource",function(e,t,n){var o;return o=new n("user_crash"),o.remaining_resource=e(t.user_crash.remaining),{list_resource:o.list_resource,detail_resource:o.detail_resource,remaining_resource:o.remaining_resource}}]).factory("PanelGroupsResource",["BaseResource",function(e){var t;return t=new e("enabled_panels").list_resource}]).factory("RegionsResource",["BaseResource",function(e){var t=new e("region");return{list_resource:t.list_resource,detail_resource:t.detail_resource}}]).factory("QuotasResource",["BaseResource",function(e){var t;return t=new e("quota").list_resource,{list_resource:t}}]).factory("InstancesResource",["BaseResource",function(e){var t=new e("instance");return t=new e("instance"),{list_resource:t.list_resource,detail_resource:t.detail_resource}}]).factory("VmUsagesResource",["BaseResource",function(e){var t;return t=new e("vm_usage"),{detail_resource:t.detail_resource}}]).factory("VolumesResource",["BaseResource",function(e){var t;return t=new e("volume"),{list_resource:t.list_resource,detail_resource:t.detail_resource}}]).factory("VolumeTypesResource",["BaseResource",function(e){var t;return t=new e("volume_type"),{list_resource:t.list_resource,detail_resource:t.detail_resource}}]).factory("VolumeSnapshotsResource",["BaseResource",function(e){var t;return t=new e("volume_snapshot"),{list_resource:t.list_resource,detail_resource:t.detail_resource}}]).factory("FlavorsResource",["BaseResource",function(e){var t;return t=new e("flavor"),{list_resource:t.list_resource,detail_resource:t.detail_resource}}]).factory("ImagesResource",["BaseResource",function(e){var t;return t=new e("image"),{list_resource:t.list_resource,detail_resource:t.detail_resource}}]).factory("SnapshotsResource",["BaseResource",function(e){var t;return t=new e("snapshot"),{list_resource:t.list_resource,detail_resource:t.detail_resource}}]).factory("SecurityGroupsResource",["BaseResource",function(e){var t;return t=new e("security_group"),{list_resource:t.list_resource,detail_resource:t.detail_resource}}]).factory("KeypairsResource",["BaseResource",function(e){var t;return t=new e("keypair"),{list_resource:t.list_resource,detail_resource:t.detail_resource}}]).factory("FloatingIpsResource",["BaseResource","$resource","ApiResource",function(e,t,n){var o;return o=new e("floating_ip"),o.pool_resource=t(n.floating_ip.list_pool),{list_resource:o.list_resource,detail_resource:o.detail_resource,pool_resource:o.pool_resource}}]).factory("LoadBalancersResource",["BaseResource",function(e){var t;return t=new e("load_balancer"),{list_resource:t.list_resource,detail_resource:t.detail_resource}}]).factory("AdminNodesResource",["BaseResource",function(e){var t;return t=new e("admin_node"),{list_resource:t.list_resource,detail_resource:t.detail_resource}}]).factory("AdminInstancesResource",["BaseResource",function(e){var t;return t=new e("admin_instance").list_resource,{list_resource:t}}]).factory("AdminServicesResource",["BaseResource",function(e){var t;return t=new e("admin_service").list_resource,{list_resource:t}}]).factory("AdminProjectsResource",["BaseResource",function(e){var t;return t=new e("admin_project"),{list_resource:t.list_resource,detail_resource:t.detail_resource}}]).factory("AdminUsersResource",["BaseResource",function(e){var t;return t=new e("admin_user"),{list_resource:t.list_resource,detail_resource:t.detail_resource}}]).factory("AdminQuotasResource",["BaseResource",function(e){var t;return t=new e("admin_quota").list_resource,{list_resource:t}}]).factory("AdminApplyCodesResource",["BaseResource",function(e){var t;return t=new e("admin_apply_code"),{list_resource:t.list_resource,detail_resource:t.detail_resource}}]),angular.module("AppService",["AppFilter"]).factory("init_quotas",function(){return function(e,t){for(var n={},o=0;e.length>o;o++)n[e[o]]={raw_used:null,raw_limit:null};for(var o=0;t.length>o;o++){var a=t[o];void 0!==n[a.name]&&(n[a.name].raw_limit=a.limit)}return n}}).factory("get_instance_quotas",function(){return function(e,t){e.instances.raw_used=t.length;for(var n=0,o=0,a=0;t.length>a;a++)n+=t[a].flavor.vcpus,o+=t[a].flavor.ram;return e.cores.raw_used=n,e.ram.raw_used=o,e}}).factory("combine_instance_flavor",function(){return function(e,t){for(var n=0;e.length>n;n++)for(var o=e[n],a=o.flavor.id,i=0;t.length>i;i++){var r=t[i];r.id==a&&(o.flavor=r)}return e}}).factory("date_formatter",function(){return Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in t)RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[n]:("00"+t[n]).substr((""+t[n]).length)));return e},function(){}}).factory("check_status",function(){return{instance_status_stable:function(e){var t=["active","sleeping","error"];return-1!=t.indexOf(e)?!0:!1},image_status_stable:function(e){var t=["active","error"];return-1!=t.indexOf(e)?!0:!1},lb_status_stable:function(e){var t=["active","error"];return-1!=t.indexOf(e)?!0:!1},volume_snapshot_status_stable:function(e){var t=["active","error"];return-1!=t.indexOf(e)?!0:!1},volume_status_stable:function(e){var t=["active","error","sleeping"];return-1!=t.indexOf(e)?!0:!1}}}).factory("is_dough_enabled",["$cookies",function(e){return function(){return"True"==e.dough_enabled?!0:!1}}]).factory("is_kanyun_enabled",["$cookies",function(e){return function(){return"True"==e.kanyun_enabled?!0:!1}}]).factory("is_loadbalance_enabled",["$cookies",function(e){return function(){return"True"==e.loadbalance_enabled?!0:!1}}]).factory("form_valid",function(){return function(e){var t=$(e),n=t.find("input.ng-invalid");return 0==n.length?!0:!1}}).factory("redirect",["$timeout","$location",function(e,t){return function(n){n!=t.path()&&e(function(){t.path(n)},500)}}]),angular.module("RestServiceV2",["CommonService"]).factory("I18nResource",["$resource","ApiResource",function(e){var t={zh_CN:e("/static/js/app/locale/zh_CN.json"),en_US:e("/static/js/app/locale/en_US.json")};return function(e){var e=void 0!==t[e]?e:"zh_CN";return"function"==typeof t[e]&&(t[e]=t[e].get()),t[e]}}]).factory("ApiList",function(){var e={panel:{list:"/resource/panels"},region:{list:"/resource/region/list"},quota:{list:"/resource/quota/list"},instance:{list:"/resource/instance/list",detail:"/resource/instance/detail/:id",console:"/resource/instance/console/",vnc:"/resource/instance/vnc/"},vm_usage:{detail:"/resource/vm_usage/detail/:id"},volume:{list:"/resource/volume/list",detail:"/resource/volume/detail/:id"},flavor:{list:"/resource/flavor/list",detail:"/resource/flavor/detail/:id"},image:{list:"/resource/image/list",detail:"/resource/image/detail/:id"},snapshot:{list:"/resource/snapshot/list",detail:"/resource/snapshot/detail/:id"},sg:{list:"/resource/security_group/list",detail:"/resource/security_group/detail/:id"},keypair:{list:"/resource/keypair/list",detail:"/resource/keypair/detail/:id",create_keypair:"/resource/keypair/create"},floating_ip:{list:"/resource/floating_ip/list",detail:"/resource/floating_ip/detail/:id",list_pool:"/resource/floating_ip/list_pool"},floating_ip_pool:{list:"/resource/floating_ip/list_pool"},load_balancer:{list:"/resource/load_balancer/list",detail:"/resource/load_balancer/detail/:id"},coupon_code:{list:"/resource/coupon/code_list"},coupon_log:{list:"/resource/coupon/log_list",remaining:"/resource/coupon/coupon_remaining"},user_crash:{list:"/resource/crash/crash_monthly_log",detail:"/resource/crash/crash_monthly_detail/:id",remaining:"/resource/crash/crash_remaining"},volume_type:{list:"/resource/volume_type/list",detail:"/resource/volume_type/detail/:id"},volume_snapshot:{list:"/resource/volume_snapshot/list",detail:"/resource/volume_snapshot/detail/:id"},admin_node:{list:"/resource/node/list",detail:"/resource/node/detail/:id"},service:{list:"/resource/service/list"},project:{list:"/resource/project/list",detail:"/resource/project/detail/:id"},user:{list:"/resource/user/list",detail:"/resource/user/detail/:id"},admin_coupon:{code_list:"/resource/coupon/code_list"},apply_code:{list:"/resource/apply_code/list",detail:"/resource/apply_code/detail/:id"},user_metadata:{ui_config:"/resource/user_metadata/ui_config"},project_usage:{list:"/resource/project_usage/list",detail:"/resource/project_usage/detail/:id"}};return{get:function(t,n){return n=n?n:"list",e[t][n]}}}).factory("CacheService",["$rootScope",function(e){var t={},n=function(n,o){if(n in t)throw Error("cacheId "+n+" taken");this.size=0,this.stats=angular.extend({},o,{id:n}),this.data={},this.init=!1,this.dump_data=[],this.cacheId=n;var a=this;return t[this.cacheId]={cache_change_event:"cache_change:"+a.cacheId,size:function(){return a.size},init:function(){return a.init},load:function(e){for(var t=0;e.length>t;t++)a.data[e[t].id]=e[t];a.init=!0},dump:function(){return a.dump_data.splice(0,a.dump_data.length),angular.forEach(a.data,function(e){this.push(e)},a.dump_data),a.dump_data},put:function(t,n){return angular.isUndefined(n)?void 0:(t in a.data||a.size++,a.data[t]=n,!a.init&&(a.init=!0),e.$broadcast(this.cache_change_event,{action:"put",id:t}),n)},get:function(e){return a.data[e]},remove:function(t){delete a.data[t],a.size--,e.$broadcast(this.cache_change_event,{action:"remove",id:t})},removeAll:function(){a.init=!1,a.data={},a.size=0,e.$broadcast(this.cache_change_event)},destroy:function(){a.data=null,a.stats=null,delete t[n]},info:function(){return angular.extend({},a.stats,{size:a.size})}},t[this.cacheId]};return n.info=function(){var e={};return angular.forEach(t,function(t,n){e[n]=t.info()}),e},n.get=function(e){return t[e]},n}]).factory("ResourcePool",["$resource","$http","$cookies","$window","ApiList","CacheService","CheckStatusService","LogCenter",function(e,t,n,o,a,i,r,c){var s=n.csrftoken;return t.defaults.headers.common["X-CSRFToken"]=s,function(n){var s=this;this.resource_url=a.get(n),this.detail_url=a.get(n,"detail"),this.cache=new i(n);var l=function(e){var t=e.status;400==t?c.error(e.data):401==t||403==t?o.location.reload():404==t||(413==t?c.warn(e.data):c.warn(e.data))},u=function(e){var t=e[0],n=e[1],o=e[2],a=e[3];switch(e.length){case 4:return[t,n,o,a];case 3:return angular.isFunction(e[1])?[t,n,o]:[t,n,o,l];case 2:return angular.isFunction(e[0])?[t,n]:angular.isFunction(e[1])?[t,n,l]:[t,n,angular.noop,l];case 1:return angular.isFunction(e[0])?[t,l]:[t,angular.noop,l];default:return[angular.noop,l]}},d=function(e){return angular.isString(e)?e:(angular.forEach(e,function(e){void 0===e.in_stable||e.in_stable||r(e.id,n)}),e)},p=function(e){return angular.isString(e)?e:(s.cache.load(e),s.cache.dump())};this.req=e(this.resource_url,{},{save_multi:{method:"POST",isArray:!0},fetch:{method:"GET",isArray:!0,transformResponse:[t.defaults.transformResponse[0],d,p]}}),this.detail_req=e(this.detail_url,{},{update:{method:"PUT"},get_list:{method:"GET",isArray:!0}}),this.fetch=function(){if(!s.cache.init()){var e=u(arguments);return s.req.fetch.apply(s,e)}var t=s.cache.dump();switch(arguments.length){case 4:return arguments[3](t);case 3:return arguments[2](t);case 2:return arguments[1](t);case 1:return angular.isFunction(arguments[0])?arguments[0](t):t;default:return t}},this.query=function(){return s.cache.removeAll(),s.req.fetch.apply(s,arguments)},this.query_no_cache=function(){var e=u(arguments);return s.req.query.apply(s,e)},this.save=function(){var e=u(arguments);s.req.save.apply(s,e)},this.save_multi=function(){var e=u(arguments);s.req.save_multi.apply(s,e)},this.remove=function(){var e=u(arguments);s.detail_req.remove.apply(s,e)},this.update=function(){var e=u(arguments);s.detail_req.update.apply(s,e)},this.get=function(){var e=u(arguments);s.detail_req.get.apply(s,e)},this.get_list=function(){var e=u(arguments);s.detail_req.get_list.apply(s,e)}}}]).factory("CheckStatusService",["$rootScope","$http","$timeout","ApiList","EventCenter",function(e,t,n,o,a){var i={queue:{},push:function(e,t){e in this.queue&&n.cancel(this.queue[e]),this.queue[e]=t},cancel:function(e){e in this.queue&&(n.cancel(this.queue[e]),delete this.queue[e])},clear:function(){for(var e=0;this.queue.length>e;e++)n.cancel(this.queue[e]);this.queue={}}},r=function(e,r){var c=o.get(r,"detail");c=c.slice(0,c.length-3)+e;var s=2e3,l=function(){var o=n(function(){return t.head(c)},s);o.then(function(t){var n=(t.data,t.status),o=t.headers;return 202!=n?(i.cancel(e),a.trigger(r+":check_stop",e),void 0):(o("x-status"),o("x-realstatus"),o("x-task"),l(),void 0)},function(t){var n=(t.data,t.status);return t.headers,404==n?(a.trigger(r+":resource_removed",e),void 0):void 0}),i.push(e,o)};l()};return r.clean_task=function(){i.clear()},r}]).factory("CouponCodePool",["ResourcePool",function(){}]).factory("CouponLogPool",["ResourcePool",function(){}]).factory("CrashPool",["ResourcePool",function(){}]).factory("PanelGroupPool",["ResourcePool",function(e){var t=new e("panel");return t}]).factory("RegionPool",["ResourcePool",function(e){var t=new e("region");return t}]).factory("QuotaPool",["ResourcePool",function(e){var t=new e("quota");return t}]).factory("FlavorPool",["ResourcePool","EventCenter","LogCenter",function(e,t,n){var o=new e("flavor"),a=function(e){o.save(e,function(e){o.cache.put(e.id,e),n.created_resource("flavor",e.name)})},i=function(e){o.remove({id:e},function(){var t=o.cache.get(e);n.deleted_resource("flavor",t.name),o.cache.remove(e)})};return t.on("flavor:create",a),t.on("flavor:remove",i),o}]).factory("ImagePool",["ResourcePool","CheckStatusService","EventCenter","LogCenter",function(e,t,n,o){var a=new e("image"),i=function(e,t){a=a.update({id:e},t,function(t){a.cache.put(e,t),o.updated_resource("image",t.name)})},r=function(e){a=a.remove({id:e},function(n){o.deleting_resource("image",n.name),t(e,"image")})};return n.on("image:update",i),n.on("image:remove",r),n.on("image:check_stop",function(e){a.get({id:e},function(t){a.cache.put(e,t),o.created_resource("image",t.name)})}),n.on("image:resource_removed",function(e){var t=a.cache.get(e);o.deleted_resource("image",t.name),a.cache.remove(e)}),a}]).factory("SnapshotPool",["redirect","ResourcePool","CheckStatusService","EventCenter","LogCenter",function(e,t,n,o,a){var i=new t("snapshot"),r=function(t){a.creating_resource("snapshot",t.name),i.save(t,function(t){i.cache.put(t.id,t),n(t.id,"snapshot"),e("/app/snapshot")})},c=function(e){a.deleting_resource("snapshot",e),i.remove({id:e},function(){i.get({id:e},function(){n(e,"snapshot")},function(t){404==t.status&&i.cache.remove(e)})})},s=function(e,t){i.update({id:e},t,function(t){i.cache.put(e,t),a.updated_resource("snapshot",t.name)})};return o.on("snapshot:create",r),o.on("snapshot:remove",c),o.on("snapshot:update",s),o.on("snapshot:check_stop",function(e){i.get({id:e},function(t){i.cache.put(e,t),a.created_resource("snapshot",t.name)})}),o.on("snapshot:resource_removed",function(e){var t=i.cache.get(e);a.deleted_resource("snapshot",t.name),i.cache.remove(e)}),i}]).factory("InstancePool",["$filter","ResourcePool","CheckStatusService","EventCenter","LogCenter",function(e,t,n,o,a){var i=e("i18n"),r=new t("instance"),c=function(e){e.count>1?a.info(i8n("creating %d instances",e.count)):a.creating_resource("instance",e.name),r.save(e,function(t){var o=e.count;o>1?r.query():(r.cache.put(t.id,t),n(t.id,"instance"))})},s=function(e){var t=r.cache.get(e);a.deleting_resource("instance",t.name),r.remove({id:e},function(){r.get({id:e},function(t){r.cache.put(e,t),n(e,"instance")},function(n){404==n.status&&(a.deleted_resource("instance",t.name),r.cache.remove(e))})})},l=function(e,t){var o=r.cache.get(e);a.info(i("start %s instance:%s",i(t.action),o.name)),r.update({id:e},t,function(o){r.cache.put(e,o),"update"!=t.action&&n(e,"instance")})};return o.on("instance:create",c),o.on("instance:remove",s),o.on("instance:action_on_instance",l),o.on("instance:resource_removed",function(e){var t=r.cache.get(e);a.deleted_resource("instance",t.name),r.cache.remove(e)}),o.on("instance:check_stop",function(e){r.get({id:e},function(t){a.success(i("instance %s is %s",t.name,t.status)),r.cache.put(e,t)})}),r}]).factory("SgPool",["ResourcePool","EventCenter","LogCenter",function(e,t,n){var o=new e("sg"),a=function(e){o.save(e,function(e){n.created_resource("sg",e.name),o.cache.put(e.id,e)})},i=function(e){o.remove({id:e},function(){var t=o.cache.get(e);n.deleted_resource("sg",t.name),o.cache.remove(e)})},r=function(e,t){o.update({id:e},t,function(t){n.updated_resource("sg",t.name),o.cache.put(e,t)})};return t.on("sg:create",a),t.on("sg:remove",i),t.on("sg:update",r),o}]).factory("VmUsagePool",["ResourcePool",function(){}]).factory("VolumePool",["$filter","ResourcePool","CheckStatusService","EventCenter","LogCenter",function(e,t,n,o,a){var i=e("i18n"),r=new t("volume"),c=function(e){r.save(e,function(e){r.cache.put(e.id,e),a.creating_resource("volume",e.name),n(e.id,"volume")})},s=function(e){r.remove({id:e},function(){r.get({id:e},function(t){a.deleting_resource("volume",t.name),r.cache.put(t.id,t),n(e,"volume")},function(t){if(404==t.status){var n=r.cache.get(e);a.deleted_resource("volume",n.name),r.cache.remove(e)}})})},l=function(e,t){r.update({id:e},t,function(t){r.cache.put(e,t),t.in_stable||(n(e,"volume"),a.success(i("successfully attached volume %s to instance ",t.name)))})},u=function(e,t){r.update({id:e},t,function(t){r.cache.put(e,t),t.in_stable||(a.success(i("successfully detached volume %s from instance ",t.name)),n(t.id,"volume"))})};return o.on("volume:create",c),o.on("volume:remove",s),o.on("volume:attach",l),o.on("volume:detach",u),o.on("volume:resource_removed",function(e){var t=r.cache.get(e);a.deleted_resource("volume",t.name),r.cache.remove(e)}),o.on("volume:check_stop",function(e){r.get({id:e},function(t){r.cache.put(e,t)})}),r}]).factory("VolumeTypePool",["ResourcePool","EventCenter","LogCenter",function(e,t,n){var o=new e("volume_type"),a=function(e){o.save(e,function(e){n.created_resource("volume_type",e.name),o.cache.put(e.id,e)})},i=function(e){o.remove({id:e},function(){var t=o.cache.get(e);n.deleted_resource("volume_type",t.name),o.cache.remove(e)})};return t.on("volume_type:create",a),t.on("volume_type:remove",i),o}]).factory("VolumeSnapshotPool",["redirect","ResourcePool","CheckStatusService","EventCenter","LogCenter",function(e,t,n,o,a){var i=new t("volume_snapshot"),r=function(t){i.save(t,function(t){i.cache.put(t.id,t),a.creating_resource("volume_snapshot",t.name),n(t.id,"volume_snapshot"),e("/app/volume_snapshot")
})},c=function(e){var t=i.cache.get(e);a.deleting_resource("volume_snapshot",t.name),i.remove({id:e},function(){i.get({id:e},function(t){i.cache.put(e,t),n(e,"volume_snapshot")},function(n){404==n.status&&(a.deleted_resource("volume_snapshot",t.name),i.cache.remove(e))})})};return o.on("volume_snapshot:create",r),o.on("volume_snapshot:remove",c),o.on("volume_snapshot:check_stop",function(e){i.get({id:e},function(t){i.cache.put(e,t)})}),o.on("volume_snapshot:resource_removed",function(e){var t=i.cache.get(e);a.deleted_resource("volume_snapshot",t.name),i.cache.remove(e)}),i}]).factory("KeypairPool",["ResourcePool","EventCenter","LogCenter",function(e,t,n){var o=new e("keypair"),a=function(e){o.save(e,function(e){n.created_resource("keypair",e.name),o.cache.put(e.id,e)})},i=function(e){o.remove({id:e},function(){var t=o.cache.get(e);n.deleted_resource("keypair",t.name),o.cache.remove(e)})};return t.on("keypair:remove",i),t.on("keypair:import",a),o}]).factory("FloatingIpPool",["ResourcePool","EventCenter","LogCenter",function(e,t,n){var o=new e("floating_ip"),a=function(e){o.save(e,function(e){n.created_resource("floating_ip",e.ip),o.cache.put(e.id,e)})},i=function(e){o.remove({id:e},function(){var t=o.cache.get(e);n.deleted_resource("floating_ip",t.ip),o.cache.remove(e)})},r=function(e,t){o.update({id:e},t,function(t){o.cache.put(e,t)})},c=function(e,t){o.update({id:e},t,function(t){o.cache.put(e,t)})};return t.on("floating_ip:allocate",a),t.on("floating_ip:release",i),t.on("floating_ip:associate",r),t.on("floating_ip:disassociate",c),o}]).factory("FloatingIpPoolPool",["ResourcePool",function(e){var t=new e("floating_ip_pool");return t}]).factory("LBPool",["ResourcePool","CheckStatusService","EventCenter","LogCenter",function(e,t,n,o){var a=new e("load_balancer"),i=function(e){a.save(e,function(e){o.creating_resource("load_balancer",e.name),a.cache.put(e.id,e),t(e.id,"load_balancer")})},r=function(e){var n=a.cache.get(e);o.deleting_resource("load_balancer",n.name),a.remove({id:e},function(){a.get({id:e},function(n){a.cache.put(e,n),t(e,"load_balancer")},function(t){404==t.status&&(o.deleted_resource("load_balancer",n.name),a.cache.remove(e))})})},c=function(e,n){a.update({id:e},n,function(n){o.updating_resource("load_balancer",n.name),a.cache.put(e,n),t(e,"load_balancer")})};return n.on("load_balancer:create",i),n.on("load_balancer:remove",r),n.on("load_balancer:update",c),n.on("load_balancer:resource_removed",function(e){var t=a.cache.get(e);o.deleted_resource("load_balancer",t.name),a.cache.remove(e)}),n.on("load_balancer:check_stop",function(e){a.get({id:e},function(t){a.cache.put(e,t)})}),a}]).factory("KanyunNodePool",["ResourcePool",function(){}]).factory("ServicePool",["ResourcePool",function(e){var t=new e("service");return t}]).factory("ProjectPool",["ResourcePool","EventCenter","LogCenter",function(e,t,n){var o=new e("project"),a=function(e){o.save(e,function(e){n.created_resource("project",e.name),o.cache.put(e.id,e)})},i=function(e){o.remove({id:e},function(){var t=o.cache.get(e);n.deleted_resource("project",t.name),o.cache.remove(e)})},r=function(e,t){o.update({id:e},t,function(t){n.updated_resource("project",t.name),o.cache.put(e,t)})},c=function(e,t){o.update({id:e},t,function(t){n.updated_resource("project",t.name),o.cache.put(e,t)})};return t.on("project:create",a),t.on("project:remove",i),t.on("project:update",r),t.on("project:update_quota",c),o}]).factory("UserPool",["ResourcePool","EventCenter","LogCenter",function(e,t,n){var o=new e("user"),a=function(e){o.save(e,function(e){n.created_resource("user",e.name),o.cache.put(e.id,e)})},i=function(e,t){o.update({id:e},t,function(t){n.updated_resource("user",t.name),o.cache.put(e,t)})},r=function(e){o.remove({id:e},function(){var t=o.cache.get(e);n.deleted_resource("user",t.name),o.cache.remove(e)})};return t.on("user:create",a),t.on("user:update",i),t.on("user:remove",r),o}]).factory("ApplyCodePool",["ResourcePool","EventCenter","LogCenter",function(e,t){var n=new e("apply_code"),o=function(e){n.save_multi(e,function(e){angular.forEach(e,function(e){n.cache.put(e.id,e)})})},a=function(e){n.remove({id:e},function(){n.cache.remove(e)})};return t.on("apply_code:create",o),t.on("apply_code:remove",a),n}]).factory("UiConfigPool",["$resource","ApiList","EventCenter","LogCenter",function(e,t,n){var o=t.get("user_metadata","ui_config"),a=e(o,{},{fetch:{method:"GET",isArray:!1}}),i=function(e){e={ui_config:e},a.save(e)};return n.on("ui_config:save",i),a}]).factory("ProjectUsagePool",["ResourcePool",function(e){var t=new e("project_usage");return t}]),angular.module("CommonService",[]).factory("form_valid",function(){return function(e){var t=$(e),n=t.find("input.ng-invalid");return 0==n.length?!0:!1}}).factory("redirect",["$timeout","$location",function(e,t){return function(n){n!=t.path()&&e(function(){t.path(n)},500)}}]).factory("LogCenter",["$rootScope","$filter",function(e,t){var n=t("i18n"),o=function(t){e.$broadcast("log_msg",t,"debug")},a=function(t){e.$broadcast("log_msg",t,"info")},i=function(t){e.$broadcast("log_msg",t,"success")},r=function(t){e.$broadcast("log_msg",t,"warn")},c=function(t){e.$broadcast("log_msg",t,"error")},s=function(e,t){var e=n(e),o=n("creating %s:%s",e,t);a(o)},l=function(e,t){var e=n(e),o=n("created %s:%s",e,t);i(o)},u=function(e,t){var e=n(e),o=n("deleting %s:%s",e,t);a(o)},d=function(e,t){var e=n(e),o=n("deleted %s:%s",e,t);i(o)},p=function(e,t){var e=n(e),o=n("updating %s:%s",e,t);a(o)},m=function(e,t){var e=n(e),o=n("updated %s:%s",e,t);i(o)};return{debug:o,info:a,success:i,warn:r,error:c,creating_resource:s,created_resource:l,deleting_resource:u,deleted_resource:d,updating_resource:p,updated_resource:m}}]).factory("EventCenter",function(){var e={on:function(e,t,o){if(!n(this,"on",e,[t,o])||!t)return this;this._events||(this._events={});var a=this._events[e]||(this._events[e]=[]);return a.push({callback:t,context:o,ctx:o||this}),this},once:function(e,t,o){if(!n(this,"once",e,[t,o])||!t)return this;var a=this,i=_.once(function(){a.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,o)},off:function(e,t,o){var a,i,r,c,s,l,u,d;if(!this._events||!n(this,"off",e,[t,o]))return this;if(!e&&!t&&!o)return this._events={},this;for(c=e?[e]:_.keys(this._events),s=0,l=c.length;l>s;s++)if(e=c[s],r=this._events[e]){if(this._events[e]=a=[],t||o)for(u=0,d=r.length;d>u;u++)i=r[u],(t&&t!==i.callback&&t!==i.callback._callback||o&&o!==i.context)&&a.push(i);a.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=[].slice.call(arguments,1);if(!n(this,"trigger",e,t))return this;var a=this._events[e],i=this._events.all;return a&&o(a,t),i&&o(i,arguments),this},stopListening:function(e,t,n){var o=this._listeners;if(!o)return this;var a=!t&&!n;"object"==typeof t&&(n=this),e&&((o={})[e._listenerId]=e);for(var i in o)o[i].off(t,n,this),a&&delete this._listeners[i];return this}},t=/\s+/,n=function(e,n,o,a){if(!o)return!0;if("object"==typeof o){for(var i in o)e[n].apply(e,[i,o[i]].concat(a));return!1}if(t.test(o)){for(var r=o.split(t),c=0,s=r.length;s>c;c++)e[n].apply(e,[r[c]].concat(a));return!1}return!0},o=function(e,t){var n,o=-1,a=e.length,i=t[0],r=t[1],c=t[2];switch(t.length){case 0:for(;a>++o;)(n=e[o]).callback.call(n.ctx);return;case 1:for(;a>++o;)(n=e[o]).callback.call(n.ctx,i);return;case 2:for(;a>++o;)(n=e[o]).callback.call(n.ctx,i,r);return;case 3:for(;a>++o;)(n=e[o]).callback.call(n.ctx,i,r,c);return;default:for(;a>++o;)(n=e[o]).callback.apply(n.ctx,t)}};return e}).factory("LocaleSetting",["$resource","$locale","$cookies","$document",function(e,t,n,o){var a=function(e){o[0].cookie="lang="+e+";path=/"},i=function(){var e=n.lang;return e?e:t.id};return{set:a,current:i}}]),angular.module("AppFilter",["RestService"]).filter("i18n",["I18nResource","LocaleSetting",function(e,t){return function(n){for(var o,a,i,r=[],c=1;arguments.length>c;c++)r.push(arguments[c]);return o=t.current(),a=e(o),i=void 0!==a[n]?a[n]:n,r.length>0&&(i=vsprintf(i,r)),i}}]).filter("uptime_format",["$filter",function(e){var t=e("i18n"),n=60,o=60*n,a=24*o,i=t("miniute"),r=t("hour"),c=t("day");return function(e){if(n>e)return 0+i;if(o>e)return e+i;if(a>e){var t=parseInt(e/60/60),s=parseInt((e-3600*t)/60);return t+r+","+s+i}var l=parseInt(e/60/60/24),t=parseInt((e-86400*l)/60/60),s=parseInt((e-86400*l-3600*t)/60);return t>0?l+c+","+t+r+","+s+i:l+c+","+s+i}}]).filter("gb_format",function(){return function(e){return parseInt(e)||(e="0"),e+"GB"}}).filter("mb_format",function(){return function(e){return parseInt(e)||(e="0"),1024>e?e+"MB":e/1024+"GB"}}).filter("month_price",function(){return function(e){if(!e)return 0;var t=e.monthly;return t?t.price+"":0}}).filter("hour_price",function(){return function(e){if(!e)return 0;var t=e.hourly;return t?t.price+"":0}}).filter("image_status_filter",function(){return function(e){return e.status}}).filter("flavor_filter",function(){return function(e){var t=e.name,n=e.ram,o=e.ephemeral,a=e.vcpus,i=e.disk;return t+"| ram:"+n+"MB| ephemeral:"+o+"GB| vcpus:"+a+"| disk:"+i+"GB"}}).filter("payment_type_filter",function(){return function(e){if(!e)return"";var t=e.product_info;if(!t)return"";var n=t.payment_type;return"hourly"==n?t.hourly.price+"/"+"hour":"monthly"==n?t.monthly.price+"/"+"month":""}}).filter("distri_filter",function(){return function(e){return"<span class='os-icon-"+e.distri+"'></span>"}}).filter("status_icon_filter",function(){return function(e){return"<span class='status-icon-"+e+"'></span>"}}).filter("sg_filter",function(){return function(e){if(e){for(var t=[],n=0;e.length>n;n++)t.push(e[n].name);return t.join(",")}}}).filter("part_filter",function(){return function(e,t){void 0===t&&(t=2);for(var n=[],o=0;t>o;o++)n[o]={};for(var a in e)n[o++%t][a]=e[a];return n}}).filter("anGrid_copy_filter",function(){return function(e){return"<span class='copy_column'>                <span class='copy_text'>{{rowData[colData.field]}}</span>                <span class='copy_btn'>                    <a ng-init='$parent.$parent.$parent.$parent.$parent."+e.anGridCopyInitFn+"( rowData[colData.field] )'                        ng-click='$parent.$parent.$parent.$parent.$parent."+e.anGridCopyFn+"($event, rowData[colData.field])' class='btn btn-small  "+e.anGridCopyClass+"'                        >{{'Copy' | i18n}}                    </a>                </span>            </span>"}}).filter("operation_connect_filter",function(){return function(){return"<span class='btn btn-small' ng-click='open_connect_instance()'>{{'Connect'|i18n}}</span>"}}).filter("moniter_metrics_format",function(){return function(){return"<a ng-repeat='metric in rowData[\"metrics\"]' ng-click=\"$emit('metric selected', rowData, metric )\" class='metric'>{{metric}}</a>"}}).filter("instance_class_filter",function(){return function(e){var t={sleeping:"gray",error:"red",building:"yellow"};return e in t?t[e]:""}}).filter("instance_status_filter",function(){return function(e){return"status"in e?e.real_status:e}}).filter("volume_attach_filter",function(){return function(e){if(e&&0!=e.length){for(var t=[],n=0;e.length>n;n++)t.push("attach to <strong>"+e[n].instance_name+"</strong> on "+e[n].device);return t.join("<br/>")}}});var app_directives=angular.module("AppDirectives",["AppService","CommonService","RestService","RestServiceV2"]);app_directives.directive("usagePieChart",function(){return{restrict:"E",replace:!0,scope:{chartId:"@",chartTitle:"@"},template:'<div class="usage_chart_wrapper"><div class="usage_chart" id="{{chartId}}"><div class="usage_percent">{{usage}}</div></div><div class="usage_chart_label">{{chartTitle|i18n}}</div></div>',link:function(e,t,n){e.render=function(){$.jqplot(n.chartId,[[["a",1],["b",2]]],{grid:{background:"white",borderWidth:"0",borderColor:"white",shadow:!1},seriesDefaults:{renderer:$.jqplot.DonutRenderer,rendererOptions:{sliceMargin:3,startAngle:-90,showDataLabels:!1}},seriesColors:["#59ad58","#d9ecd8"]}),e.$apply(function(){var t=e.$parent.selectedItems[0],o=n.chartId;"cpu_usage"==o?e.usage=t.cpu:"mem_usage"==o?e.usage=t.mem_percent:"disk_usage"==o&&(e.usage=t.disk_percent)})}}}}).directive("vmNode",function(){return{restrict:"E",replace:!0,template:"<div><div class='vm_node_active'></div></div>"}}),app_directives.directive("topbardropdown",["$location",function(e){return{restrict:"E",scope:{items:"=",iconleft:"@",iconright:"@"},replace:!0,template:'<span class="btn" data-toggle="dropdown" href="#"><i ng-show="iconleft" class="iconleft {{iconcolor}} {{iconleft}}"></i><span>{{items[0].name|i18n}}</span><i ng-show="iconright" class="iconright {{iconcolor}} {{iconright}}"></i><ul ng-show="items.length > 1" class="dropdown-menu" role="menu" aria-labelleby="dLabel"><li ng-repeat="item in items"><a ng-click="item_click(item)" ng-hide="$index == 0" >{{item.name|i18n}}</a></li></ul></span>',link:function(t,n,o){t.view_change=function(t){e.path(t.link)},t.iconcolor="icon-black";var a=$(n[0]),i=$(n.children(".dropdown-menu")[0]);a.find(".iconleft"),a.find(".iconright"),o.iconright,t.hovered=!1,n.mouseenter(function(){n.siblings().children(".dropdown-menu.open").removeClass("open"),n.addClass("open")});var r=null;n.mouseleave(function(){n.hasClass("open")&&(r=window.setTimeout(function(){n.removeClass("open")},100))}),i.mouseenter(function(){null!==r&&window.clearTimeout(r)}),i.mouseleave(function(){n.hasClass("open")&&n.removeClass("open")}),t.item_click=function(e){void 0==e.callback?t.view_change(e):e.callback(e)}}}}]).directive("sidepanel",function(){return{restrict:"E",scope:{group:"=",selectedPanel:"="},replace:!0,template:"<div class='nav-group'><li class='menu-header' ng-click='toggle_panel()' ng-class='{\"active\": has_item_selected()}'><i class='icon-th-list'></i><i ng-class='{\"icon-chevron-down\": folded == false, \"icon-chevron-right\": folded == true}' ></i>{{group.name|i18n}}</li><ul ui-sortable='{axis:\"y\"}' class='nav'><li ng-repeat='panel in group.panels' ng-class='{\"active\": selectedPanel == panel.name}'><a ng-href='/app/{{panel.name}}' class='sidebar-{{panel.name}}'><i class='icon-icon'></i>{{panel.name|i18n}}</a></li></ul></div>",link:function(e,t){e.folded=!1,e.has_item_selected=function(){for(var t=0;e.group.panels.length>t;t++){var n=e.group.panels[t];if(n.name==e.selectedPanel)return!0}return!1},e.toggle_panel=function(){e.folded?($(t).find(".nav").slideDown(),e.folded=!1):($(t).find(".nav").slideUp(),e.folded=!0)}}}}).directive("confirmDialog",function(){return{restrict:"E",scope:{title:"@",msg:"@",action:"&",confirmDialogShown:"="},templateUrl:"/static/js/templates/common/confirmDialog.html",link:function(e,t,n){e.close_modal=function(){e.confirmDialogShown=!1},e.perform_action=function(){e.submitted=!0,e.action(),e.close_modal()},e.$watch("confirmDialogShown",function(t){t&&(e.submitted=!1)}),e._title=n.title?n.title:"Confirm",e._msg=n.msg?n.msg:"Confirm to delete?"}}}).directive("stdCenterWrapper",function(){return{restrict:"C",link:function(e,t){if($(t).height($("body").height()-120),0!=t.find(".buttom_region").length){e.height=Math.max(130,$("#panel_center").height()/3),$(t).splitter({type:"h",sizeTop:e.height});var n=function(){null==e.height&&(e.height=t.find(".upper_region").height()),t.find(".upper_region").height("100%"),e.$broadcast("pushheight")},o=function(){t.find(".upper_region").height(e.height),e.height=null,e.$broadcast("popheight")};t.hasClass("activable")&&n(),e.$watch("selectedItems",function(e){e&&1==e.length?(t.addClass("active"),t.hasClass("activable")&&o()):(t.removeClass("active"),t.hasClass("activable")&&n())})}else t.find(".upper_region").height("100%")}}}).directive("dropDownBtn",function(){return{restrict:"A",scope:{disabled:"=",onClick:"&"},link:function(e,t){var n=$(t);n.on("click",function(){e.disabled||e.onClick()}),e.$watch("disabled",function(e){e?n.addClass("dropdown-btn-disabled"):n.removeClass("dropdown-btn-disabled")}),e.label_toggle=function(t){var n=t.type;return"toggle_pause"==n?1!=e.$parent.selectedItems.length?"Pause Instance":"paused"==e.$parent.selectedItems[0].status?"Unpause Instance":"Pause Instance":"toggle_suspend"==n?1!=e.$parent.selectedItems.length?"Suspend Instance":"suspended"==e.$parent.selectedItems[0].status?"Resume Instance":"Suspend Instance":"toggle_stop"==n?1!=e.$parent.selectedItems.length?"Stop":"shutoff"==e.$parent.selectedItems[0].status?"Start Instance":"Stop Instance":void 0}}}}).directive("pageLoader",function(){return{restrict:"E",replace:!0,template:"<div class='page-loader hide'><span>loading..</span></div>",link:function(e,t){e.$on("load_complete",function(){$(t).addClass("hide")}),e.$on("load_start",function(){$(t).removeClass("hide")})}}}).directive("notifyWindow",["$timeout",function(e){return{restrict:"E",replace:!0,templateUrl:"/static/js/templates/common/notify.html",link:function(t,n){var o=function(){var e=new Date;return e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()};t.msgs={data:[],push:function(e,t){this.data.push({date:o(),msg:e,level:t})},clean:function(){this.data=[]}},t.$on("log_msg",function(o,a,i){i=i||"info",t.msgs.push(a,i),!t.display_full&&$(n).find(".notify_min a").fadeOut().fadeIn(),e(function(){var e=$(n).find(".msg_wrapper").last()[0];e&&e.scrollIntoViewIfNeeded()},100)})}}}]).directive("uiConfig",function(){return{restrict:"A",replace:!0,transclude:!0,template:"<div><i class='icon-cog'></i><div class='trans-box' ng-transclude><i class='ui-up-arrow'></i></div> </div>",link:function(e,t){$(".ui-config i").hide(),$(t).parent().hover(function(){$(".ui-config i").fadeIn()},function(){$(".ui-config i").fadeOut(),$(".ui-config div").slideUp(200)}),$(".ui-config i").on("click",function(){$(".ui-config div").slideToggle(200)})}}}),app_directives.directive("createApplyCode",["EventCenter",function(e){return{restrict:"E",replace:!0,scope:{createApShown:"="},templateUrl:"/static/js/templates/admin/apply_code/create_ap.html",link:function(t){t.submit=function(){var n={count:t.count};e.trigger("apply_code:create",n),t.close_create_ap_modal()},t.close_create_ap_modal=function(){t.createApShown=!1}}}}]),app_directives.directive("chart",function(){var e=function(e,t,n){var o=0,a=function(){void 0!==n.withPaging&&t.find(".arrow").click(function(){o+=$(this).hasClass("arrow_left")?-1:1,e.refresh()})};a();var i=function(e){e=1e3*e;var t=new Date(e),n=t.getMonth()+1,o=t.getDate(),a=t.getHours(),i=t.getMinutes();return n+"/"+o+" "+a+":"+i},r=function(){var t,n=new Date;return n=n.getTime()/1e3,t=60*e.timeRange,n-=t,i(n)};e.resize=function(){void 0===n.width&&(e.width=t.width()),void 0===n.height&&(e.height=t.height()),$("#"+e.id+"_chart").html("").css({width:e.width,height:e.height}),t.addClass("chart")};var c=function(){return{id:e.id,metric:e.metric,statistic_method:e.statisticMethod,time_range:e.timeRange,time_period:e.timePeriod}},s=function(o){if(void 0===$||void 0===$.jqplot||0==$("#"+e.id+"_chart").length)return setTimeout(s,200),void 0;if(e.resize(),e.option={},e.option.animate=o?!0:!1,e.option.animateReplot=o?!0:!1,e.option.axes={xaxis:{renderer:$.jqplot.DateAxisRenderer,tickOptions:{formatString:"%m/%d %H:%M"},min:r()},yaxis:{tickOptions:{formatString:"%.2f"+window.monitor.options.unit}}},e.option.series=[{lineWidth:2,markerOptions:{show:!1},rendererOptions:{smooth:!0}}],e.option.title=n.title,void 0!==e.color())if("object"==typeof e.color())for(var a in e.color())a>=e.option.series.length?e.option.series.push({color:e.color()[a]}):e.option.series[a].color=e.color()[a];else for(var a in e.option.series)e.option.series[a].color=e.color;e.option.highlighter={show:!0,sizeAdjust:7.5},e.option.cursor={show:!1,tooltipLocation:"e"};var l=l?l:e.id+"_chart",u="/resource/vm_usage/detail/"+e.id,d=function(e){var t=[[]],n=c();return-1!==e.indexOf("undefined")?t:($.ajax({async:!1,url:e,data:n,dataType:"json",success:function(e){if(0==e.values.length)return t[0].push([i(Date.parse(new Date)/1e3),0]),t;for(var n=e.values,o=0;n.length>o;o++)t[0].push([i(n[o].x),n[o].y])}}),t)};e.option.dataRenderer=d,$.jqplot(l,u,e.option);var p=t.find(".jqplot-series-canvas").eq(0);if(p&&void 0!==n.withPaging){var m=t.find(".arrow.arrow_left").eq(0);m.css({left:p.css("left"),top:p.css("top"),height:p.css("height")});var f=t.find(".arrow.arrow_right").eq(0);f.css({left:1*p.css("left").replace("px","")+1*p.css("width").replace("px","")-f.width(),top:p.css("top"),height:p.css("height")})}};e.refresh=function(){s(!0)},e.$watch("metric",function(t){void 0!==t&&e.chart_shown&&e.refresh()}),e.$watch("id",function(t){void 0!==t&&e.chart_shown&&e.refresh()}),e.$watch("statisticMethod",function(t){void 0!==t&&e.chart_shown&&e.refresh()}),e.$watch("timeRange",function(t){void 0!==t&&e.chart_shown&&e.refresh()}),e.$watch("timePeriod",function(t){void 0!==t&&e.chart_shown&&e.refresh()}),e.$on("popheight",function(){e.chart_shown=!0,e.refresh()}),e.$on("pushheight",function(){e.chart_shown=!1})};return{restrict:"E",replace:!0,scope:{charid:"@id",width:"@",height:"@",title:"@",color:"&",datasource:"@",dataconfig:"&",withPaging:"@",id:"=uuid",metric:"=",statisticMethod:"=",timeRange:"=",timePeriod:"="},template:'<div class="chart"><div id="{{id}}_chart" style="float:left"><p style="color:#777;text-align:center">loading...</p></div></div>',link:e}}).directive("smallChart",[function(){return{restrict:"E",replace:!0,templateUrl:"/static/js/templates/project/monitor/small_chart.html",scope:{chartId:"@",metric:"@",id:"=",timeRange:"=",timePeriod:"="},link:function(e,t,n){var o=!1,a=function(e){return $.jqplot.sprintf("%.2f",e)},i={cpu:"CPU Utilization",blk_read:"Disk Read",blk_write:"Disk Write",nic_outgoing:"Net Out",nic_incoming:"Net In",vmnetwork:"Vmnetwork"};e.chart_title=i[n.metric];var r=function(e){e=1e3*e;var t=new Date(e),n=t.getMonth()+1,o=t.getDate(),a=t.getHours(),i=t.getMinutes();return n+"/"+o+" "+a+":"+i},c=function(){var t,n=new Date;return n=n.getTime()/1e3,t=60*e.timeRange,n-=t,r(n)},s=function(){return{id:n.id,metric:n.metric,statistic_method:e.statistic_method,time_range:e.timeRange,time_period:e.timePeriod}},l=function(e){var t=[[]],n=s();return $.ajax({async:!1,url:e,data:n,dataType:"json",success:function(e){if(0==e.values.length)return t[0].push([r(Date.parse(new Date)/1e3),0]),void 0;for(var n=e.values,o=0;n.length>o;o++)t[0].push([r(n[o].x),n[o].y])}}),t};e.statistic_methods=[{value:"avg",name:"average"},{value:"max",name:"max"},{value:"min",name:"min"},{value:"sum",name:"sum"}],e.statistic_method=e.statistic_methods[0].value,e.statistic_method_changed=function(){e.render()},e.render=function(){var t={animate:!0,animateReplot:!0,grid:{background:"white"},axesDefaults:{tickOptions:{showGridline:!1}},axes:{xaxis:{renderer:$.jqplot.DateAxisRenderer,tickOptions:{formatString:"%m/%d %H:%M"},min:c()},yaxis:{tickOptions:{formatter:function(e,t){var o=n.metric;return"cpu"==o?a(t)+"%":1024>t?a(t)+"B":1048576>t?a(t/1024)+"KB":1073741824>t?a(t/1024/1024)+"MB":a(t/1024/1024/1024)+"GB"}}}},series:[{lineWidth:2,markerOptions:{show:!1},rendererOptions:{smooth:!0}}],highlighter:{sizeAdjust:7.5},cursor:{style:"pointer",show:!0,showTooltip:!0,tooltipLocation:"e"},dataRenderer:l},i="/resource/vm_usage/detail/"+e.id;$.jqplot.eventListenerHooks.pop(),$.jqplot.eventListenerHooks.push(["jqplotClick",function(){e.monitor_detail=!0}]),void 0!==e.current_chart&&e.current_chart.destroy(),e.current_chart=$.jqplot(e.chartId+"_chart",i,t),o=!0},e.$watch("timeRange",function(){o&&e.render()}),e.$watch("timePeriod",function(){o&&e.render()})}}}]),app_directives.directive("createCouponModal",["CouponCodeResource",function(e){return{restrict:"E",replace:!0,scope:{modalShown:"="},templateUrl:"/static/js/templates/admin/coupon/create_coupon.html",link:function(t){t.submit=function(){var n={value:t.value,count:t.count};e.list_resource.create(n,{multi:!0},function(){e.list_resource.fetch({from_cache:1})}),t.close_modal()},t.close_modal=function(){t.modalShown=!1}}}}]).directive("loadCouponModal",["CouponLogResource",function(e){return{restrict:"E",replace:!0,scope:{modalShown:"="},templateUrl:"/static/js/templates/project/balance/load_coupon.html",link:function(t){t.submit=function(){var n={code:t.code};e.list_resource.create(n,null,function(){e.remaining_resource.get(function(e){t.$parent.coupon_remaining=e.remaining}),e.list_resource.fetch({year:(new Date).getFullYear(),from_cache:1})}),t.close_modal()},t.close_modal=function(){t.modalShown=!1}}}}]),app_directives.directive("createFlavorModal",["is_dough_enabled","FlavorPool","EventCenter",function(e,t,n){return{restrict:"E",replace:!0,scope:{modalShown:"="},templateUrl:"/static/js/templates/admin/flavor/create_flavor.html",link:function(t){t.is_dough_enabled=function(){return e()},t.submit=function(){var e={name:t.name,vcpu:t.vcpu,ram:t.ram,disk:t.disk,ephemeral:t.ephemeral,swap:t.swap};t.is_dough_enabled()&&(e.hourly=t.hourly,e.monthly=t.monthly),n.trigger("flavor:create",e),t.close_modal()},t.close_modal=function(){t.modalShown=!1}}}}]).directive("flavorNameValid",["FlavorPool",function(e){return{restrict:"A",require:"ngModel",link:function(t,n,o,a){t.flavor_name_valid=function(t){for(var n=e.fetch(),o=0;n.length>o;o++){var a=n[o];if(a.name==t)return!1}return!0},a.$parsers.unshift(function(e){return t.flavor_name_valid(e)?(a.$setValidity("flavor_name_valid",!0),e):(a.$setValidity("flavor_name_valid",!1),e)})}}}]),app_directives.directive("allocateIp",["FloatingIpPoolPool","EventCenter",function(e,t){return{restrict:"E",replace:!0,scope:{allocateIpShown:"="},templateUrl:"/static/js/templates/project/floating_ip/allocate_ip.html",link:function(n){n.$watch("allocateIpShown",function(t){t&&(n.pool_list=e.fetch(function(e){return n.ip_pool=e[0],e}))}),n.submit_allocate_ip=function(){var e={pool:n.ip_pool.name};t.trigger("floating_ip:allocate",e),n.closeModal()},n.closeModal=function(){n.allocateIpShown=!1}}}}]).directive("associateIp",["FloatingIpPool","InstancePool","EventCenter",function(e,t,n){return{restrict:"E",replace:!0,scope:{associateIpShown:"="},templateUrl:"/static/js/templates/project/floating_ip/associate_ip.html",link:function(e){e.submit=function(){data={action:"associate",instance_uuid:e.instance_uuid},n.trigger("floating_ip:associate",e.$parent.selectedItems[0].id,data),e.closeModal()},e.$watch("associateIpShown",function(n,o){n!==o&&(e.instance_list=t.fetch(function(t){return e.instance_uuid=t[0].id,t}))}),e.closeModal=function(){e.associateIpShown=!1},e.$on("associate_ip_shown",function(){e.floating_ip=e.$parent.selectedItems[0].ip})}}}]),app_directives.directive("modalHeader",function(){return{restrict:"E",replace:!0,scope:{title:"@"},templateUrl:"/static/js/templates/common/modal_header.html",link:function(e){e.close=e.$parent.closeModal}}}).directive("modalFooter",["form_valid",function(e){return{restrict:"E",replace:!0,scope:{cancelText:"@",okText:"@",formInvalid:"=",completeUpload:"="},templateUrl:"/static/js/templates/common/modal_footer.html",link:function(t,n,o){t._cancelText=o.cancelText||"Cancel",t._okText=o.okText||"Create",t.close=t.$parent.closeModal,t.form_invalid=function(){var o=$(n).parent("form");return e(o[0])?t.formInvalid?t.formInvalid():!1:!0}}}}]).directive("modalDesc",function(){return{restrict:"E",replace:!0,scope:{title:"@",desc:"@"},templateUrl:"/static/js/templates/common/modal_desc.html",link:function(e,t,n){e._title=n.title||"Description"}}}).directive("bInput",["$compile",function($compile){return{restrict:"E",replace:!0,scope:{type:"@",label:"@",value:"=",name:"@",placeholder:"@",model:"=",required:"@",validate:"@"},templateUrl:"/static/js/templates/common/bootstrap_input.html",link:function(scope,elem,attr){scope._required=eval(void 0===attr.required?!0:attr.required);var validate=void 0===attr.validate?"":eval(attr.validate).join(" "),type=attr.type||"text",placeholder=attr.placeholder||"",name=attr.name||"",input='<input value="{{value}}" name="'+name+'" type="'+type+'" placeholder="'+placeholder+'" ng-model="model" ng-required="_required" '+validate+">"+"</input>";$(elem).find(".controls").append($compile(input)(scope))}}}]).directive("bSelect",["$compile",function($compile){return{restrict:"E",replace:!0,scope:{label:"@",model:"=",name:"@",required:"@",options:"=",optionId:"@",optionName:"@"},templateUrl:"/static/js/templates/common/bootstrap_input.html",link:function(scope,elem,attr){scope._required=eval(attr.required||!0);var optionId=attr.optionId||"id",optionName=attr.optionName||"name",name=attr.name||"",option_str="item."+optionId+" as item."+optionName+" for item in options",select='<select name="'+name+'" ng-model="model" ng-required="_required" ng-options="'+option_str+'">'+"</select>";$(elem).find(".controls").append($compile(select)(scope))}}}]).directive("bTextarea",["$compile",function($compile){return{restrict:"E",replace:!0,scope:{label:"@",model:"=",required:"@"},templateUrl:"/static/js/templates/common/bootstrap_input.html",link:function(scope,elem,attr){scope._required=eval(attr.required||!1);var textarea="<textarea ng-model='model' ng-required='_required'/>";$(elem).find(".controls").append($compile(textarea)(scope))}}}]),app_directives.directive("integer",function(){var e=/^\-?\d*$/;return{require:"ngModel",link:function(t,n,o,a){a.$parsers.unshift(function(t){return e.test(t)?(a.$setValidity("integer",!0),t):(a.$setValidity("integer",!1),void 0)})}}}).directive("intRange",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,o){var a=angular.fromJson(n.intRange),i=a[0],r=a[1];o.$parsers.unshift(function(e){return i>e||e>r?(o.$setValidity("int_valid",!1),void 0):(o.$setValidity("int_valid",!0),e)})}}}).directive("sourceValid",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,o){o.$parsers.unshift(function(e){var t=/^(25[0-5]|2[0-4]\d|[0-1]?\d?\d)(\.(25[0-5]|2[0-4]\d|[0-1]?\d?\d)){3}\/(3[0-2]|[1-2]?\d)$/;return t.test(e)?(o.$setValidity("source_valid",!0),e):(o.$setValidity("source_valid",!1),void 0)})}}}).directive("portRangeValid",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,o){o.$parsers.unshift(function(e){var t=/^(\d+)$|^(\d+)\s*-\s*(\d+)$/,n=t.exec(e),a=function(e){var t=1,n=65535;return e>=t&&n>=e};if(null!=n){if(void 0!=n[1]){if(!a(n[1]))return o.$setValidity("port_range_valid",!1),void 0}else{if(!a(n[2])||!a(n[3]))return o.$setValidity("port_range_valid",!1),void 0;if(n[2]>=n[3])return o.$setValidity("port_range_valid",!1),void 0}return o.$setValidity("port_range_valid",!0),e}return o.$setValidity("port_range_valid",!1),void 0})}}}),app_directives.directive("createImage",function(){return{restrict:"E",replace:!0,scope:{modalShown:"="},templateUrl:"/static/js/templates/admin/image/create_image.html",link:function(e,t){e.closeModal=function(){e.modalShown=!1},e.image_formats=[{id:"aki",name:"AKI - Amazon Kernel Image"},{id:"ami",name:"AMI - Amazon Machine Image"},{id:"ari",name:"ARI - Amazzon Ramdisk Image"},{id:"iso",name:"ISO - optical Disk Image"},{id:"qcow2",name:"QCOW2 - QEMU Emulator"},{id:"raw",name:"Raw"},{id:"vdi",name:"VDI"},{id:"vhd",name:"VHD"},{id:"vmdk",name:"VHDK"}],e.form_invalid=function(){return e.disk_format?e.copy_from||""!=$(t).find("input[type=file]")[0].value?void 0:!0:!0},e.complete_upload=function(e,t){console.log(e),console.log(t)},e.csrf_token=$.cookie("csrftoken")}}}),app_directives.directive("launchInstance",["$filter","combine_instance_flavor","init_quotas","get_instance_quotas","is_dough_enabled","VolumePool","QuotaPool","SnapshotPool","ImagePool","KeypairPool","SgPool","InstancePool","FlavorPool","CouponLogResource","CrashResource","EventCenter",function(e,t,n,o,a,i,r,c,s,l,u,d,p,m,f,_){return{restrict:"E",replace:!0,scope:{modalShown:"=launchInstanceShown"},templateUrl:"/static/js/templates/project/instance/launch_instance.html",link:function(e){e.snapshots=[],e.images=[],e.payment_type="hourly",e.snapshots=c.fetch(function(t){return t.length>0&&(e.snapshot_uuid=t[0].id),t}),e.images=s.fetch(function(t){return t.length>0&&(e.image_uuid=t[0].id),t}),e.keypairs=l.fetch(function(t){return t.length>0&&(e.instance_keypair=t[0]),t
}),e.$on("cache_change:keypair",function(){e.keypairs=l.fetch()}),e.security_groups=u.fetch(),e.$on("cache_change:sg",function(){e.security_groups=u.fetch()}),r.fetch(function(t){e.quotas=n(["instances","cores","gigabytes","ram"],t),d.fetch(function(t){e.instances=t,e.quotas=o(e.quotas,e.instances),e.availableInstance=e.quotas.instances.raw_limit-e.quotas.instances.raw_used,i.fetch(function(t){for(var n=0,o=0;t.length>o;o++)n+=t[o].size;e.quotas.gigabytes.raw_used=n})})}),e.$watch("modalShown",function(t){t&&a()&&(m.remaining_resource.get(function(t){e.coupon_remaining=t.remaining}),f.remaining_resource.get(function(t){e.balance_remaining=t.remaining}))}),e.is_dough_enabled=a(),e.unable_to_create_instance=function(t){var n=t.instance_flavor.$invalid,o=t.instance_name.$invalid,i=t.instance_keypair.$invalid,r=e.need_keypair();if(r||(i=!1),n||o||i)return!0;if(a()){var c=e.coupon_remaining+e.balance_remaining;if(e.current_charge()>c)return!0}return!1},e.create_instance=function(){var t,n,o=e.instance_name,i=e.flavorSelected.id,r=e.user_data,c=e.instance_sg,s=e.instance_copies,l=e.need_keypair();n="image"==e.user_image_type?e.image_uuid:e.snapshot_uuid,a()&&(t=e.flavorSelected.product_info[e.payment_type].product_id);var u={name:o,image_uuid:n,flavor_uuid:i,user_data:r,security_groups:c,count:s,product_id:t};l&&(u.key_uuid=e.instance_keypair.id),_.trigger("instance:create",u),e.close_modal()},e.close_modal=function(){e.modalShown=!1},e.$on("launch_instance_with_snapshot",function(t,n){e.user_image_type="snapshot",e.snapshot_uuid=n.id}),e.$on("launch_instance_with_image",function(t,n){e.user_image_type="image",e.image_uuid=n.id}),e.$watch("availableInstance",function(t){e.instanceCopies=[];for(var n=1;t>=n;n++)e.instanceCopies.push(n);e.instance_copies=e.instanceCopies[0]}),e.flavor_price=function(){if(!a())return"";if(e.flavorSelected){var t=e.flavorSelected.product_info[e.payment_type];return t.price+t.currency+"/"+t.order_unit}},e.current_charge=function(){if(!a())return 0;if(e.flavorSelected){var t=e.flavorSelected.product_info[e.payment_type];return t.price*e.instance_copies}},e.need_keypair=function(){if(0==e.images.length)return!0;if("image"==e.user_image_type){for(var t=e.image_uuid,n=null,o=0;e.images.length>o;o++)e.images[o].id==t&&(n=e.images[o]);if("windows"==n.os_type)return!1}return!0},e.open_create_sg_modal=function(){e.sg_modal_shown=!0,e.update_sg=!1},e.open_create_keypair_modal=function(){e.keypair_modal_shown=!0,e.import_keypair=!1}}}}]).directive("connectInstance",["$filter","ApiList",function(e,t){var n=function(e,n){e.initTab=navigator.userAgent.indexOf("Window")>0?"windows":"linux";var o=t.get("instance","vnc");e.$watch("modalShown",function(t){if(t){e.keypair=e.$parent.selectedItems[0].key_name,e.vnc_url=o+e.$parent.selectedItems[0].id;var n=e.$parent.selectedItems[0].ssh_domain,a=n.split(":");e.domain=a[0],e.port=a[1]}}),e.open_vnc=function(){window.open(e.vnc_url)},e.closeModal=function(){e.modalShown=!1};var a=n.controller("ngModel");a.$viewValue=e.initTab,a.$render()};return{restrict:"E",replace:!0,scope:{modalShown:"="},templateUrl:"/static/js/templates/project/instance/connect_instance.html",link:n}}]).directive("dropdowntable",["is_dough_enabled","FlavorPool",function(e,t){return{restrict:"E",transclude:!0,scope:{flavorSelected:"="},link:function(n){n.thead=["name","VCPU","disk","ephemeral","ram"],n.data_attr_name=["name","vcpus","disk","ephemeral","ram"],e()&&(n.thead.push("hourly","monthly"),n.data_attr_name.push("hourly","monthly")),t.fetch(function(e){n.data=[];for(var t=0;e.length>t;t++){var o={name:e[t].name,vcpus:e[t].vcpus,disk:e[t].disk,ephemeral:e[t].ephemeral,ram:e[t].ram,origin_flavor:e[t]};if(null!=e[t].product_info){var a=e[t].product_info.hourly.price+" "+e[t].product_info.hourly.currency,i=e[t].product_info.monthly.price+" "+e[t].product_info.monthly.currency;o.hourly=a,o.monthly=i}n.data.push(o)}}),n.selecting=function(e){n.select_show=!1,n.select_value=e[n.data_attr_name[0]],n.flavorSelected=e.origin_flavor}},template:'<div><input type="text" name="instance_flavor" class="dropdown-select" ng-model="select_value" ng-init="select_show=false" ng-click="select_show=true" readonly="readonly" required><div  class="dropdown-select-wrapper"><table class="dropdown-select-table" ng-show="select_show" ng-model="select_show"><thead><tr><th ng-repeat="head in thead">{{head}}</th></tr></thead><tbody><tr ng-repeat="flavor in data" ng-click="selecting(flavor)"><td ng-repeat="key in data_attr_name">{{flavor[key]}}</td></tr></tbody></table></div></div>',replace:!0}}]).directive("editInstance",["EventCenter",function(e){return{restrict:"E",replace:!0,scope:{modalShown:"="},templateUrl:"/static/js/templates/project/instance/edit_instance.html",link:function(t){t.submit=function(){var n={name:t.name,action:"update"};e.trigger("instance:action_on_instance",t.$parent.selectedItems[0].id,n),t.close_modal()},t.close_modal=function(){t.modalShown=!1},t.$watch("modalShown",function(e){if(e){var n=t.$parent.selectedItems[0];t.name=n.name}})}}}]).directive("takeSnapshot",["EventCenter",function(e){return{restrict:"E",replace:!0,scope:{modalShown:"="},templateUrl:"/static/js/templates/project/instance/take_snapshot.html",link:function(t){t.submit=function(){var n={name:t.name,instance_id:t.$parent.selectedItems[0].id};e.trigger("snapshot:create",n),t.close_modal()},t.close_modal=function(){t.modalShown=!1}}}}]),app_directives.directive("keypairmodal",["$timeout","ApiList","KeypairPool","EventCenter",function(e,t,n,o){return{restrict:"E",replace:!0,scope:{keypairModalShown:"=",importKeypair:"="},templateUrl:"/static/js/templates/project/keypair/keypair_modal.html",link:function(a){a.key_exist=function(e){return n.fetch(function(t){for(var n=0;t.length>n;n++)if(t[n].name==e)return!1;return!0})},a.create_url=t.get("keypair","create_keypair"),a.refresh_keypairs=function(){a.$parent.keypairs=n.query(function(e){return a.$parent.instance_keypair=a.$parent.keypairs[0],e})},a.import_keypair=function(e,t){var n={name:e,public_key:t};o.trigger("keypair:import",n)},a.close_keypair_modal=function(){a.keypairModalShown=!1},a.can_submit=function(e){return a.importKeypair&&e.keypair_name.$valid&&e.public_key.$valid||!a.importKeypair&&e.keypair_name&&e.keypair_name.$valid},a.submit_keypair=function(){a.importKeypair?(a.import_keypair(a.keypair_name,a.public_key),a.close_keypair_modal()):(function(e){e("iframe#temp-download").length?e("iframe#temp-download").attr("src",a.create_url+"/"+a.keypair_name):e("<iframe></iframe>").attr({id:"temp-download",src:a.create_url+"/"+a.keypair_name}).appendTo("body:eq(0)").hide()}(jQuery),a.close_keypair_modal(),e(a.refresh_keypairs,1e3))}}}}]).directive("keypairNameValid",["KeypairPool",function(e){return{restrict:"A",require:"ngModel",link:function(t,n,o,a){t.key_name_valid=function(t){for(var n=e.fetch(),o=0;n.length>o;o++)if(n[o].name==t)return console.log("exist"),!1;return!0},a.$parsers.unshift(function(e){return t.key_name_valid(e)?(a.$setValidity("key_name_valid",!0),e):(a.$setValidity("key_name_valid",!1),e)})}}}]),app_directives.directive("loadbalancermodal",["LBPool","InstancePool","EventCenter",function(e,t,n){return{restrict:"E",replace:!0,scope:{modalShown:"=",editLoadBalancer:"="},templateUrl:"/static/js/templates/project/load_balancer/load_balancer_modal.html",link:function(e){e.load_balancer_name="",e.instances=t.fetch(),e.$watch("modalShown",function(t){if(t&&e.editLoadBalancer){var n=e.$parent.selectedItems[0];e.id=n.id,e.load_balancer_name=n.name,e.protocol=n.protocol,e.instance_port=n.instance_port,e.balancing_method=n.config.balancing_method,e.server_name=n.http_server_names,e.instance=n.instance_uuids}}),e.submit=function(){var t,o=e.protocol;t={name:e.load_balancer_name,protocol:e.protocol,instance_port:parseInt(e.instance_port),instance_uuids:e.instance,config:{balancing_method:e.balancing_method,health_check_target_path:"/",health_check_timeout_ms:5e3,health_check_interval_ms:3e4,health_check_healthy_threshold:5,health_check_unhealthy_threshold:3}},"http"==o&&(t.http_server_names=e.server_name),e.editLoadBalancer?n.trigger("load_balancer:update",e.id,t):n.trigger("load_balancer:create",t),e.close_modal()},e.close_modal=function(){e.modalShown=!1},e.can_submit=function(e){return e.load_balancer_name.$valid&&e.protocol.$valid&&e.instance_port.$valid&&e.balancing_method.$valid&&e.instance.$valid&&("tcp"==e.protocol.$modelValue||e.server_name.$valid)}}}}]).directive("loadBalancerNameValid",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,o){e.max_length_limit=function(e){return 40>=e.length},e.illegal_characters=function(e){return/^[a-zA-Z0-9]*?$/.test(e)},o.$parsers.unshift(function(t){return o.$setValidity("max_length_limit",e.max_length_limit(t)),o.$setValidity("illegal_characters",e.illegal_characters(t)),t})}}}).directive("instancePortValid",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,o){e.valid=function(e){return e>0&&65536>=e},o.$parsers.unshift(function(t){return o.$setValidity("valid",e.valid(t)),t})}}}).directive("serverNameValid",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,o){e.baddomain=function(e){return/^[a-zA-Z0-9][a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][a-zA-Z0-9]{0,62})*$/.test(e)},o.$parsers.unshift(function(t){return""!==t&&o.$setValidity("baddomain",e.baddomain(t)),t})}}}),app_directives.directive("quotaitem",["$filter",function(e){return{restrict:"E",replace:!0,scope:{resourceName:"=",resourceRawLimit:"=",resourceRawUsed:"=",flavorSelected:"=",copies:"="},template:"<div class='quota_item_wrapper'><div class='quota_title clearfix'><a class='title'>{{resourceName|i18n}}(<span>{{format_display(resourceRawUsedScoped)}} {{'used'|i18n}}</span>)</a><p class='limit' ng-hide='resourceRawLimit == null'>{{format_display(resourceRawLimit)}} total</p></div><div class='quota_bar'><div class='progress progress-striped active'><div class='bar' ng-class='{\"bar-warning\": resourcePercent>50 && resourcePercent<100, \"bar-danger\": resourcePercent>=100}' style='width: {{resourcePercent}}%'></div></div></div></div>",link:function(t){var n=e("gb_format"),o=e("mb_format");t.format_display=function(e){return"gigabytes"==t.resourceName?n(e):"ram"==t.resourceName?o(e):e},t.$watch("resourceRawUsed",function(e){void 0!==e&&(t.resourceRawUsedScoped=e)}),t.$watch("resourceRawUsedScoped",function(e){void 0!==e&&null!==e&&(t.resourcePercent=100*(t.resourceRawUsedScoped/t.resourceRawLimit))}),t.$watch("flavorSelected",function(e){if(void 0!==e&&void 0!==t.copies){var n=parseInt(t.resourceRawUsed),o=t.copies;t.resourceRawUsedScoped="cores"==t.resourceName?n+parseInt(e.vcpus)*o:"gigabytes"==t.resourceName?n+parseInt(e.disk)*o:"instances"==t.resourceName?n+1*o:"ram"==t.resourceName?n+parseInt(e.ram)*o:n}}),t.$watch("copies",function(e){if(void 0!==e&&void 0!==t.flavorSelected){var n=parseInt(t.resourceRawUsed),o=t.flavorSelected;t.resourceRawUsedScoped="cores"==t.resourceName?n+parseInt(o.vcpus)*e:"gigabytes"==t.resourceName?n+parseInt(o.disk)*e:"instances"==t.resourceName?n+1*e:"ram"==t.resourceName?n+parseInt(o.ram)*e:n}})}}}]).directive("launchnode",function(){return{restrict:"E",replace:!0,scope:{availableInstance:"=",onClick:"&"},template:"<div class='node large' ng-click='onClick()'><div class='node-inner launch'><span class='content'><div><h1>{{availableInstance}}</h1><q>{{'available'|i18n}}</q></div><div><h1>+</h1><q>{{'launch'|i18n}}</q></div></span></div></div>"}}).directive("instancenode",[function(){return{restrict:"E",scope:{name:"=",instanceUuid:"=",flavorName:"=",status:"=",uptime:"="},replace:!0,template:"<div class='node large'><div class='node-inner' ng-class='status|instance_class_filter'><span class='content'><div>{{name}}</div><div>{{flavorName}}</div><div>{{'uptime'|i18n}}:{{uptime|uptime_format}}</div></span></div></div>"}}]),app_directives.directive("createProjectModal",["EventCenter",function(e){return{restrict:"E",replace:!0,scope:{modalShown:"="},templateUrl:"/static/js/templates/admin/project/create_project.html",link:function(t){t.submit=function(){var n={name:t.name,description:t.description,enabled:t.enabled};e.trigger("project:create",n),t.close_modal()},t.close_modal=function(){t.modalShown=!1}}}}]).directive("editProjectModal",["EventCenter",function(e){return{restrict:"E",replace:!0,scope:{modalShown:"="},templateUrl:"/static/js/templates/admin/project/edit_project.html",link:function(t){t.submit=function(){var n={action:"update_info",name:t.name,description:t.description,enabled:t.enabled};e.trigger("project:update",t.$parent.selectedItems[0].id,n),t.close_modal()},t.close_modal=function(){t.modalShown=!1},t.$on("edit_project_shown",function(){var e=t.$parent.selectedItems[0];t.name=e.name,t.description=e.description,t.enabled=e.enabled})}}}]).directive("manageProjectModal",[function(){return{restrict:"E",replace:!0,scope:{modalShown:"="},templateUrl:"/static/js/templates/admin/project/manage_project.html",link:function(e){e.close_modal=function(){e.modalShown=!1}}}}]).directive("modifyQuotaModal",["ProjectPool","EventCenter",function(e,t){return{restrict:"E",replace:!0,scope:{modalShown:"="},templateUrl:"/static/js/templates/admin/project/modify_quota.html",link:function(n){n.get_quota=function(){e.get_list({id:n.$parent.selectedItems[0].id,action:"get_quota"},function(e){for(var t=0;e.length>t;t++){var o=e[t];n[o.name]=o.limit}})},n.submit=function(){var e={action:"update_quota",injected_file_content_bytes:n.injected_file_content_bytes,metadata_items:n.metadata_items,injected_files:n.injected_files,gigabytes:n.gigabytes,ram:n.ram,floating_ips:n.floating_ips,instances:n.instances,volumes:n.volumes,cores:n.cores};t.trigger("project:update_quota",n.$parent.selectedItems[0].id,e),n.close_modal()},n.close_modal=function(){n.modalShown=!1},n.$on("modify_quota_shown",function(){n.get_quota()})}}}]),app_directives.directive("sg",["$filter","EventCenter",function(e,t){return{restrict:"E",replace:!0,scope:{modalShown:"=",updateSg:"="},templateUrl:"/static/js/templates/project/security_group/sg.html",link:function(n){var o=e("i18n");n.name_not_null=o("name not null"),n.desc_not_null=o("description not null"),n.port_range_info=o("port range info"),n.icmp_type_info=o("type info"),n.icmp_code_info=o("code info"),n.source_info=o("source info"),n.quick_rules=[],n.quick_rules.push([{name:"SAE Bridge",protocol:"tcp",port_range:"1-65535",source:"0.0.0.0/0"},{name:"All TCP",protocol:"tcp",port_range:"1-65535",source:"0.0.0.0/0"},{name:"All UDP",protocol:"udp",port_range:"1-65535",source:"0.0.0.0/0"},{name:"All ICMP",protocol:"icmp",type:"-1",code:"-1",source:"0.0.0.0/0"}]),n.quick_rules.push([{name:"SSH",protocol:"tcp",port_range:"22",source:"0.0.0.0/0"},{name:"MySQL",protocol:"tcp",port_range:"3306",source:"0.0.0.0/0"},{name:"DNS",protocol:"udp",port_range:"53",source:"0.0.0.0/0"},{name:"RDP",protocol:"tcp",port_range:"3389",source:"0.0.0.0/0"}]),n.quick_rules.push([{name:"HTTP",protocol:"tcp",port_range:"80",source:"0.0.0.0/0"},{name:"HTTPS",protocol:"tcp",port_range:"443",source:"0.0.0.0/0"},{name:"POP3",protocol:"tcp",port_range:"110",source:"0.0.0.0/0"},{name:"POP3S",protocol:"tcp",port_range:"995",source:"0.0.0.0/0"}]),n.quick_rules.push([{name:"SMTP",protocol:"tcp",port_range:"25",source:"0.0.0.0/0"},{name:"SMTPS",protocol:"tcp",port_range:"465",source:"0.0.0.0/0"},{name:"IMAP",protocol:"tcp",port_range:"143",source:"0.0.0.0/0"},{name:"IMAPS",protocol:"tcp",port_range:"993",source:"0.0.0.0/0"}]),n.rule_categories=[{protocol:"tcp",cols:{"1.protocol":"TCP","2.port_range":"Port Range","3.source":"Source"}},{protocol:"udp",cols:{"1.protocol":"UDP","2.port_range":"Port Range","3.source":"Source"}},{protocol:"icmp",cols:{"1.protocol":"ICMP","2.type":"Type","3.code":"Code","4.source":"Source"}}],n.category_col_order=function(e){var t=[];for(var n in e.cols){var o=/.\.(\w*)/.exec(n);0==t.length&&"protocol"==o[1]?t.push("nothing"):t.push(o[1])}return t},n.rule_mapping=new function(){var e={},t={};this.all=function(){return e},this.count=function(e){return void 0!==e?t[e]:t.tcp+t.udp+t.icmp},this.add=function(o){if("Array"!=typeof o){if(null!==o.protocol){var a=n(o);void 0===e[o.protocol][a]&&(e[o.protocol][a]=o,t[o.protocol]++)}}else for(var i in o)this.add(o[i])},this.has=function(t){var o=void 0!==e[t.protocol][n(t)];return o},this.toggle=function(e){this.has(e)?this.remove(e):this.add(e)},this.get=function(t){return e[t]},this.getRaw=function(t){if(t){var n=[];for(var o in e)for(var a in e[o])n.push(e[o][a]);return n}return e},this.remove=function(o){var a=n(o);void 0!==e[o.protocol][a]&&(delete e[o.protocol][a],t[o.protocol]--)},this.reset=function(){e={tcp:{},udp:{},icmp:{}};for(var n in e)t[n]=0},this.reset();var n=function(e){switch(e.protocol){case"tcp":case"udp":return 1*/\d*/.exec(e.port_range)+1e5+"#"+e.port_range+"@"+e.source;case"icmp":return e.type+"@"+e.code+"@"+e.source}}},n.create_sg=function(e){t.trigger("sg:create",e),n.close_sg_modal()},n.update_sg=function(e,o){t.trigger("sg:update",e,o),n.close_sg_modal()},n.$watch("modalShown",function(e){if(e&&(n.rule_mapping.reset(),n.updateSg))for(var t=n.$parent.selectedItems[0].rules,o=0;t.length>o;o++){var a={source:t[o].source,protocol:t[o].ip_protocol};"icmp"==t[o].ip_protocol?(a.type=t[o].from_port,a.code=t[o].to_port):a.port_range=t[o].from_port==t[o].to_port?t[o].from_port:t[o].from_port+"-"+t[o].to_port,n.rule_mapping.add(a)}});var a=function(e){var t,n,o=(""+e).split("-");return 1==o.length?t=n=o[0]:2==o.length&&(t=$.trim(o[0]),n=$.trim(o[1])),{from_port:t,to_port:n}};n.close_sg_modal=function(){n.modalShown=!1},n.new_rule=function(e){var t,o=a(e.port_range.$modelValue);t=o.from_port==o.to_port?o.from_port:o.from_port+"-"+o.to_port,n.rule_mapping.add({protocol:e.protocol.$modelValue,port_range:t,type:e.type.$modelValue,code:e.code.$modelValue,source:e.source.$modelValue})},n.can_submit=function(e){return n.updateSg||e.sg_name&&e.sg_desc&&e.sg_name.$valid&&e.sg_desc.$valid},n.add_rule_valid=function(e){return("tcp"==e.protocol.$modelValue||"udp"==e.protocol.$modelValue)&&e.port_range.$valid&&e.source.$valid||"icmp"==e.protocol.$modelValue&&e.type.$valid&&e.code.$valid&&e.source.$valid},n.submit_sg=function(e){for(var t=n.rule_mapping.getRaw(!0),o=[],i=0;t.length>i;i++){var r,c,s=t[i];if("icmp"==s.protocol)r=s.type,c=s.code;else{var l=a(s.port_range);r=l.from_port,c=l.to_port}o.push({ip_protocol:s.protocol,from_port:r,to_port:c,source:s.source})}var u={rules:o};if(n.updateSg){var d=n.$parent.selectedItems[0].id;u.name=n.$parent.selectedItems[0].name,u.description=n.$parent.selectedItems[0].description,n.update_sg(d,u)}else u.name=e.sg_name.$modelValue,u.description=e.sg_desc.$modelValue,n.create_sg(u)}}}}]),app_directives.directive("updateSnapshot",["SnapshotPool","EventCenter",function(e,t){return{restrict:"E",replace:!0,scope:{updateSnapshotShown:"="},templateUrl:"/static/js/templates/project/snapshot/update_snapshot.html",link:function(e){e.update_snapshot=function(){var n={name:e.snapshot_name,is_public:!1,disk_format:e.disk_format,container_format:e.container_format};t.trigger("snapshot:update",e.$parent.selectedItems[0].id,n),e.close_update_snapshot()},e.close_update_snapshot=function(){e.updateSnapshotShown=!1},e.$on("update_snapshot_shown",function(){var t=e.$parent.selectedItems[0];e.snapshot_name=t.name,e.kernel_id=t.properties.kernel_id,e.ramdisk_id=t.properties.ramdisk_id,e.architecture=t.properties.architecture,e.container_format=t.container_format,e.disk_format=t.disk_format})}}}]),app_directives.directive("swiftList",["EventCenter",function(e){return{restrict:"E",scope:!0,replace:!0,template:'<div class="swift-list"><div class="swift-list-paths"><span class="swift-list-path" ng-repeate="path in paths">{{path.name}}</span></div><div class="swift-list-grid" ng-grid="{data:"files"}"></div></div>',link:function(t,n,o){"swift-data-name"in o&&!(!attrs["swift-data-name"]in t.$parent)&&(t.files=t.$parent[attrs["swift-data-name"]],t.paths=[],t.changePath=function(t){e.trigger("swift:changePath",t)},t.createFolder=function(){},t.uploadFile=function(){})}}}]),app_directives.directive("createUserModal",["ProjectPool","UserPool","EventCenter",function(e,t,n){return{restrict:"E",replace:!0,scope:{modalShown:"=",isEdit:"=",selectedItems:"="},templateUrl:"/static/js/templates/admin/user/create_user.html",link:function(t){t.submit=function(){var e={name:t.name,email:t.email,password:t.password,project_uuid:t.project_uuid,enabled:t.enabled};t.isEdit?n.trigger("user:update",t.$parent.selectedItems[0].id,e):n.trigger("user:create",e),t.close_modal()},t.$watch("modalShown",function(n){n&&(t.project_list=e.fetch(function(e){return t.project_uuid=e[0].id,e}))}),t.close_modal=function(){t.modalShown=!1},t.can_submit=function(){return t.updateSg||sg_form.sg_name&&sg_form.sg_desc&&sg_form.sg_name.$valid&&sg_form.sg_desc.$valid},t.$watch("modalShown",function(){if(t.modalShown){var e=t.isEdit,n=t.$parent.selectedItems[0];t.name=e?n.name:"",t.email=e?n.email:"",t.password="",t.confirm_password="",t.project_uuid=e?0:0,t.enabled=e?n.enabled:!0,$("#input_name").attr({"name-valid-except":t.name}),e&&$("#create_user_form .help-inline").hide()}})}}}]).directive("nameValid",["UserPool",function(e){return{restrict:"A",require:"ngModel",link:function(t,n,o,a){t.users=e.fetch(),console.log(t.users),a.$parsers.unshift(function(e){for(var n=!1,o=0;t.users.length>o;o++)if(t.users[o].name.toLowerCase()===e.toLowerCase()){n=!0;break}var i=$("#input_name").attr("name-valid-except");return i||(i=""),e.toLowerCase()==i.toLowerCase()&&(n=!1),a.$setValidity("repeated",!n),n||a.$setValidity("required",!0),e})}}}]).directive("sameAsValid",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,o){e.sameAs=n.sameAs,o.$parsers.unshift(function(t){var a=$(e.sameAs).val()==t;return n.sameAsValidOff&&(a=!1),o.$setValidity("same_as_valid",a),t})}}}).directive("emailFormatValid",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,o){o.$parsers.unshift(function(e){return o.$setValidity("email_format_valid",""==e||/.@./.test(e)),e})}}}).directive("lengthLimitValid",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,o){o.$parsers.unshift(function(e){return void 0!==n.lengthMin&&o.$setValidity("too_short",0==e.length||e.length>=n.lengthMin),void 0!==n.lengthMax&&o.$setValidity("too_long",e.length<=n.lengthMax),e}),void 0!==e.lengthMin&&o.$setValidity("too_short",!1)}}}),app_directives.directive("createVt",["EventCenter",function(e){return{restrict:"E",replace:!0,scope:{modalShown:"="},templateUrl:"/static/js/templates/admin/volume/create_vt.html",link:function(t){t.closeModal=function(){t.modalShown=!1},t.submit=function(){e.trigger("volume_type:create",{name:t.name}),t.closeModal()}}}}]).directive("vtExist",["VolumeTypePool",function(e){return{restrict:"A",require:"ngModel",link:function(t,n,o,a){t.vt_name_valid=function(t){var n=e.fetch(function(e){for(var n=0;e.length>n;n++)if(e[n].name==t)return!1;return!0});return n},a.$parsers.unshift(function(e){return t.vt_name_valid(e)?(a.$setValidity("vt_exit",!0),e):(a.$setValidity("vt_exit",!1),e)})}}}]).directive("createVolume",["redirect","VolumePool","VolumeTypePool","VolumeSnapshotPool","form_valid","EventCenter",function(redirect,VolumePool,VolumeTypePool,VolumeSnapshotPool,form_valid,EventCenter){return{restrict:"E",replace:!0,scope:{modalShown:"=",createFromSnapshot:"@"},templateUrl:"/static/js/templates/project/volume/create_volume.html",link:function(scope,elem,attr){scope.closeModal=function(){scope.modalShown=!1},VolumePool.fetch(),scope.submit=function(){var e={name:scope.name,description:scope.description,volume_type:scope.volume_type,size:scope.size};scope._createFromSnapshot&&(e.snapshot_id=scope.snapshot_id),EventCenter.trigger("volume:create",e),scope.closeModal(),scope._createFromSnapshot&&redirect("/app/volume")},scope.volume_types=VolumeTypePool.fetch(),scope.form_invalid=function(){return void 0===scope.volume_type?!0:!1},scope._createFromSnapshot=eval(attr.createFromSnapshot||!1),scope.$watch("modalShown",function(e){e&&scope.createFromSnapshot&&(scope.volume_snapshots=[],VolumeSnapshotPool.fetch(function(e){angular.forEach(e,function(e){e.id==scope.$parent.selectedItems[0].id&&(this.push({id:e.id,name:e.name+"("+e.size+"GB)"}),scope.snapshot_id=e.id)},scope.volume_snapshots)}))})}}}]).directive("editAttachment",["InstancePool","EventCenter",function(e,t){return{restrict:"E",replace:!0,scope:{modalShown:"="},templateUrl:"/static/js/templates/project/volume/edit_attachment.html",link:function(n){n.closeModal=function(){n.modalShown=!1},n.form_invalid=function(){return void 0===n.instance_id?!0:!1},n.submit=function(){var e=n.$parent.selectedItems[0].id,o={action:"attach",instance_id:n.instance_id,device:n.device,id:e};t.trigger("volume:attach",e,o),n.closeModal()},n.$watch("modalShown",function(t){t&&e.fetch(function(e){n.instance_list=e})})}}}]).directive("editDetachment",["EventCenter",function(e){return{restrict:"E",replace:!0,scope:{modalShown:"="},templateUrl:"/static/js/templates/project/volume/edit_detachment.html",link:function(t){t.closeModal=function(){t.modalShown=!1},t.submit=function(){var n=t.$parent.selectedItems[0],o={action:"detach",instance_id:n.attachments[0].server_id,id:n.id};e.trigger("volume:detach",n.id,o),t.closeModal()},t.$watch("modalShown",function(e){if(e){var n=t.$parent.selectedItems[0].attachments[0];t.instance_name=n.instance_name,t.device=n.device}})}}}]).directive("createVolumeSnapshot",["redirect","VolumeSnapshotPool","EventCenter",function(e,t,n){return{restrict:"E",replace:!0,scope:{modalShown:"="},templateUrl:"/static/js/templates/project/volume/create_volume_snapshot.html",link:function(e){t.fetch(),e.closeModal=function(){e.modalShown=!1},e.submit=function(){var t={volume_id:e.$parent.selectedItems[0].id,name:e.name,description:e.description};n.trigger("volume_snapshot:create",t),e.closeModal()}}}}]);var app_module=angular.module("App",["ui","ngCookies","bootstrap","anGrid","RestService","RestServiceV2","CommonService","AppService","AppFilter","AppDirectives"]).value("ui.config",{jq:{tooltip:{placement:"right"},popover:{trigger:"hover",placement:"bottom"}}}).config(["$routeProvider","$locationProvider",function(e,t){e.when("/app/test",{templateUrl:"/static/js/templates/test.html",controller:"TestCtrl"}).when("/app/overview",{templateUrl:"/static/js/templates/project/overview/index.html",controller:"user.OverviewCtrl"}).when("/app/instance",{templateUrl:"/static/js/templates/project/instance/index.html",controller:"user.InstanceCtrl"}).when("/app/volume",{templateUrl:"/static/js/templates/project/volume/index.html",controller:"user.VolumeCtrl"}).when("/app/volume_snapshot",{templateUrl:"/static/js/templates/project/volume/snapshot.html",controller:"user.VolumeSnapshotCtrl"}).when("/app/image",{templateUrl:"/static/js/templates/project/image/index.html",controller:"user.ImageCtrl"}).when("/app/snapshot",{templateUrl:"/static/js/templates/project/snapshot/index.html",controller:"user.SnapshotCtrl"}).when("/app/security_group",{templateUrl:"/static/js/templates/project/security_group/index.html",controller:"user.SgCtrl"}).when("/app/keypair",{templateUrl:"/static/js/templates/project/keypair/index.html",controller:"user.KeypairCtrl"}).when("/app/floating_ip",{templateUrl:"/static/js/templates/project/floating_ip/index.html",controller:"user.FloatingIpCtrl"}).when("/app/load_balancer",{templateUrl:"/static/js/templates/project/load_balancer/index.html",controller:"user.LBCtrl"}).when("/app/monitor",{templateUrl:"/static/js/templates/project/monitor/index.html",controller:"user.MonitorCtrl"}).when("/app/billing",{templateUrl:"/static/js/templates/project/billing/index.html",controller:"user.BillingCtrl"}).when("/app/balance",{templateUrl:"/static/js/templates/project/balance/index.html",controller:"user.BalanceCtrl"}).when("/app/admin_overview",{templateUrl:"/static/js/templates/admin/overview/index.html",controller:"admin.OverviewCtrl"}).when("/app/admin_instance",{templateUrl:"/static/js/templates/admin/instance/index.html",controller:"user.InstanceCtrl"}).when("/app/admin_volume",{templateUrl:"/static/js/templates/admin/volume/index.html",controller:"admin.VolumeCtrl"}).when("/app/admin_service",{templateUrl:"/static/js/templates/admin/service/index.html",controller:"admin.ServiceCtrl"}).when("/app/admin_flavor",{templateUrl:"/static/js/templates/admin/flavor/index.html",controller:"admin.FlavorCtrl"}).when("/app/admin_image",{templateUrl:"/static/js/templates/admin/image/index.html",controller:"admin.ImageCtrl"}).when("/app/admin_project",{templateUrl:"/static/js/templates/admin/project/index.html",controller:"admin.ProjectCtrl"}).when("/app/admin_user",{templateUrl:"/static/js/templates/admin/user/index.html",controller:"admin.UserCtrl"}).when("/app/admin_quota",{templateUrl:"/static/js/templates/admin/quota/index.html",controller:"admin.QuotaCtrl"}).when("/app/admin_coupon",{templateUrl:"/static/js/templates/admin/coupon/index.html",controller:"admin.CouponCtrl"}).when("/app/admin_apply_code",{templateUrl:"/static/js/templates/admin/apply_code/index.html",controller:"admin.ApplyCodeCtrl"}).otherwise({redirectTo:"/app/overview"}),t.html5Mode(!0)}]);app_module.controller("AppCtrl",["$window","$filter","$timeout","$scope","$rootScope","$location","$cookies","PanelGroupsResource","RegionsResource","LocaleSetting",function(e,t,n,o,a,i,r,c,s,l){var u=t("i18n");o.user_console="true"==r.user_console?"false":"true",o.logout=function(){e.location.href="/accounts/logout/"},o.products=[],o.regions=[],o.services=[],o.user_info=[{name:r.username||"User",link:"#"},{name:"Logout",link:"/accounts/logout/",callback:o.logout}];var d=function(){l.set(this.lang)};o.lang=[{name:u("Language")},{name:"简体中文",lang:"zh_CN",callback:d},{name:"English",lang:"en_US",callback:d}],o.help_links=[{name:"Document",link:"#"}];var p=function(e){for(var t=i.path().substring(5),n=0;e.length>n;n++)for(var a=e[n].panels,r=0;a.length>r;r++){var c=a[r];c.name==t&&(o.selected_panel=c.name)}};o.panel_groups=c.query(function(e){for(var t=0;e.length>t;t++){var n=e[t],a="/app/"+n.panels[0].name;o.products.push({name:n.name,link:a})}p(e)}),s.list_resource.fetch({},function(e){for(var t=function(e){return function(){location.href=location.origin+"/app/region_change/"+"?endpoint="+e.link+"&region_name="+e.name}},n=0;e.length>n;n++)e[n].callback=t(e[n]);for(var a=null,i=0;e.length>i;i++){var r=e[i];if(r.current){a=r,e.splice(i,1);break}}e.unshift(a),o.regions=e}),o.toggle_user_admin_console=function(){document.cookie="true"==r.user_console?"user_console=false; path=/":"user_console=true; path=/",e.location.reload()},a.$on("$routeChangeStart",function(){if(void 0!==e.ajax_list){for(var t=0;e.ajax_list.length>t;t++)n.cancel(e.ajax_list[t]);e.ajax_list=[]}}),a.$on("$routeChangeSuccess",function(){i.path().substring(5),o.services=[],0!==o.panel_groups.length&&p(o.panel_groups)})}]),app_module.controller("TestCtrl",["$scope","UiConfigPool","EventCenter",function(e,t,n){t.fetch(function(e){console.log(e)}),e.click=function(){n.trigger("ui_config:save",{a:1,b:2})},e.gridOptions={data:"keypairs",showFilter:!0,showSelectionCheckbox:!0,showColumnMenu:!0,maintainColumnRatios:!0,enableColumnResize:!0,plugins:[new ngGridFlexibleHeightPlugin],selectedItems:e.selectedItems,columnDefs:[{field:"name",displayName:"Name"},{field:"fingerprint",displayName:"Fingerprint"}]}}]),app_module.controller("admin.ApplyCodeCtrl",["$scope","ApplyCodePool","EventCenter",function(e,t,n){e.open_create_ap=function(){e.create_ap_shown=!0},e.open_confirm_dialog=function(){e.confirm_dialog_shown=!0},e.delete_aps=function(){for(var t=0;e.selectedItems.length>t;t++){var o=e.selectedItems[t];n.trigger("apply_code:remove",o.id)}},e.$emit("load_start"),e.apply_codes=t.fetch(function(t){return e.$emit("load_complete"),t}),e.selectedItems=[],e.gridOptions={angridStyle:"th-list",data:"apply_codes",multiSelectWithCheckbox:!0,columnDefs:[{field:"id",displayName:"Code"},{field:"used_by",displayName:"Used by"},{field:"used",displayName:"Used"},{field:"used_at",displayName:"Used At"}],selectedItems:e.selectedItems},e.$on("cache_change:apply_code",function(){e.apply_codes=t.fetch()
})}]),app_module.controller("admin.CouponCtrl",["$scope","CouponCodeResource",function(e,t){e.$emit("load_start"),e.coupons=t.list_resource.fetch({},function(){e.$emit("load_complete")}),e.open_create_coupon=function(){e.create_coupon_shown=!0},e.selectedItems=[],e.gridOptions={angridStyle:"th-list",multiSelectWithCheckbox:!0,data:"coupons",columnDefs:[{field:"code",displayName:"Code"},{field:"sn",displayName:"SN"}],selectedItems:e.selectedItems},e.$watch("gridOptions.selectedItems",function(t){e.selectedItems=t})}]),app_module.controller("admin.FlavorCtrl",["$scope","is_dough_enabled","FlavorPool","EventCenter","$filter",function(e,t,n,o){e.open_create_flavor=function(){e.create_flavor_shown=!0},e.open_confirm_dialog=function(){e.confirm_dialog_shown=!0},e.delete_flavors=function(){for(var t=0;e.selectedItems.length>t;t++){var n=e.selectedItems[t];o.trigger("flavor:remove",n.id)}},e.$emit("load_start"),e.flavors=n.fetch(function(t){return e.$emit("load_complete"),t});var a=[{field:"name",displayName:"Name"},{field:"vcpus",displayName:"Cores"},{field:"ram",displayName:"Ram",columnFilter:"mb_format"},{field:"disk",displayName:"Root Disk",columnFilter:"gb_format"},{field:"ephemeral",displayName:"Ephemeral",columnFilter:"gb_format"}];t()&&a.push({field:"product_info",displayName:"Monthly Price",columnFilter:"month_price"},{field:"product_info",displayName:"Hourly Price",columnFilter:"hour_price"}),e.selectedItems=[],e.gridOptions={angridStyle:"th-list",multiSelectWithCheckbox:!0,data:"flavors",columnDefs:a,selectedItems:e.selectedItems},e.$watch("gridOptions.selectedItems",function(t){e.selectedItems=t}),e.$on("cache_change:flavor",function(){e.flavors=n.fetch()})}]),app_module.controller("admin.ImageCtrl",["$scope","ImagePool","EventCenter",function(e,t,n){e.$emit("load_start"),e.images=t.fetch(function(t){return e.$emit("load_complete"),t}),e.open_confirm_dialog=function(){e.confirm_dialog_shown=!0,e.displayItem},e.open_create_image=function(){e.create_image_shown=!0},e.delete_images=function(){for(var t=0;e.selectedItems.length>t;t++){var o=e.selectedItems[t];n.trigger("image:remove",o.id)}},e.selectedItems=[],e.gridOptions={angridStyle:"th-list",multiSelectWithCheckbox:!0,data:"images",columnDefs:[{field:"name",displayName:"Name"},{field:"status",displayName:"Status",columnFilter:"image_status_filter"},{field:"is_public",displayName:"Public"},{field:"container_format",displayName:"Container Format"}],selectedItems:e.selectedItems},e.$watch("gridOptions.selectedItems",function(t){e.selectedItems=t,0!=e.selectedItems.length&&(e.displayItem=e.selectedItems[0])}),e.$on("cache_change:image",function(){e.images=t.fetch()})}]),app_module.controller("admin.OverviewCtrl",["$scope","$location","is_kanyun_enabled","AdminNodesResource",function(e,t,n,o){n()||t.path("/app/admin_instance"),e.$emit("load_start"),e.node_list=o.list_resource.fetch({from_cache:1},function(){e.$emit("load_complete")}),e.selectedItems=[],e.gridOptions={angridStyle:"th",data:"node_list",multiSelectWithCheckbox:!0,columnDefs:[{field:"hostname",displayName:"Host Name",cssClass:"col1"},{field:"cpu",displayName:"CPU",cssClass:"col2"},{field:"mem",displayName:"Memory",cssClass:"col3"},{field:"disk",displayName:"Disk Capacity",cssClass:"col4"}],selectedItems:e.selectedItems},e.$watch("gridOptions.selectedItems",function(t){e.selectedItems=t}),e.$on("popheight",function(){var t=e.selectedItems[0];o.detail_resource.query({id:t.id,get_vm:!0},function(t){e.vm_list=t}),setTimeout(function(){angular.element("#cpu_usage").scope().render(),angular.element("#mem_usage").scope().render(),angular.element("#disk_usage").scope().render()},2e3)})}]),app_module.controller("admin.ProjectCtrl",["$scope","CouponLogResource","CrashResource","ProjectPool","UserPool","InstancePool","$filter","EventCenter",function(e,t,n,o,a,i,r,c){e.$emit("load_start"),e.projects=o.fetch(function(t){return e.$emit("load_complete"),t}),e.project_users=[],e.quotas={},e.quotas.Instances={raw_limit:3,raw_used:1},e.quotas.Snapshots={raw_limit:30,raw_used:10},e.quotas.vCPU={raw_limit:30,raw_used:10},e.quotas["Security Groups"]={raw_limit:30,raw_used:10},e.quotas.Memory={raw_limit:30,raw_used:10},e.quotas["Key Pairs"]={raw_limit:30,raw_used:10},e.quotas.Disk={raw_limit:30,raw_used:10},e.quotas["Floating IPs"]={raw_limit:30,raw_used:10},e.quotas["Load Balancers"]={raw_limit:30,raw_used:10},e.viewQuotas=r("part_filter")(e.quotas),e.open_create_project=function(){e.create_project_shown=!0},e.open_confirm_dialog=function(){e.confirm_dialog_shown=!0},e.open_edit_project=function(){e.edit_project_shown=!0,e.$broadcast("edit_project_shown")},e.open_manage_user=function(){e.manage_user_shown=!0},e.open_modify_quota=function(){e.modify_quota_shown=!0,e.$broadcast("modify_quota_shown")},e.delete_projects=function(){for(var t=0;e.selectedItems.length>t;t++){var n=e.selectedItems[t];c.trigger("project:remove",n.id)}},e.selectedItems=[],e.gridOptions={angridStyle:"th-list",multiSelectWithCheckbox:!0,data:"projects",columnDefs:[{field:"name",displayName:"Name"},{field:"enabled",displayName:"Enabled"},{field:"description",displayName:"Description"}],selectedItems:e.selectedItems},e.usersGridOptions={angridStyle:"th-list",multiSelectWithCheckbox:!0,data:"project_users",columnDefs:[{field:"id",displayName:"UUID"},{field:"name",displayName:"Name"},{field:"email",displayName:"Email"},{field:"enabled",displayName:"Enabled"}]};var s=(new Date).getFullYear(),l=2011,u=[];e.selected_year=s;for(var d=l;s>=d;d++)u.push(d);e.select_years=u,e.billingGridOptions={angridStyle:"th-list",multiSelectWithCheckbox:!0,data:"crash_log",columnDefs:[{field:"month",displayName:"Month"},{field:"summary",displayName:"Summary"},{field:"instance",displayName:"Instance"},{field:"network",displayName:"Network"},{field:"floating_ip",displayName:"Floating Ip"}],selectedItems:e.selectedItems},e.instancesGridOptions={angridStyle:"th-list",multiSelectWithCheckbox:!0,data:"project_instances",columnDefs:[{field:"image_name",displayName:"OS",width:"5%"},{field:"name",displayName:"Name"},{field:"private_ip",displayName:"Private Ip"},{field:"flavor",displayName:"Flavor",columnFilter:"flavor_filter"},{field:"payment_type",displayName:"Payment Type"},{field:"status",displayName:"Status",columnFilter:"status_filter"},{field:"ssh_domain",displayName:"Public Domain"},{field:"security_groups",displayName:"Security Groups",columnFilter:"sg_filter"},{field:"key_name",displayName:"Key Name"}]},e.$watch("gridOptions.selectedItems",function(o){if(e.selectedItems=o,0!=e.selectedItems.length){e.displayItem=e.selectedItems[0];var r=e.selectedItems[0].id;a.query_no_cache({tenant_id:r},function(t){e.project_users=[];for(var n=0;t.length>n;n++)e.project_users.push(t[n])}),i.query_no_cache({tenant_id:r},function(t){e.project_instances=[];for(var n=0;t.length>n;n++)e.project_instances.push(t[n])}),e.coupon_remaining=t.remaining_resource.get({id:r},function(t){e.coupon_remaining=t.remaining}),e.crash_remaining=n.remaining_resource.get({id:r},function(t){e.crash_remaining=t.remaining}),e.$watch("selected_year",function(t){void 0!==t&&(e.crash_log=n.list_resource.fetch({from_cache:1,year:t,id:r}))})}}),e.$on("cache_change:project",function(){e.projects=o.fetch()})}]),app_module.controller("admin.QuotaCtrl",["$scope","QuotaPool",function(e,t){e.$emit("load_start"),e.quotas=t.fetch(function(t){return e.$emit("load_complete"),t}),e.selectedItems=[],e.gridOptions={angridStyle:"th-list",multiSelectWithCheckbox:!0,data:"quotas",columnDefs:[{field:"name",displayName:"Name"},{field:"limit",displayName:"Limit"}],selectedItems:e.selectedItems},e.$watch("gridOptions.selectedItems",function(t){e.selectedItems=t}),e.$on("cache_change:quota",function(){e.quotas=t.fetch()})}]),app_module.controller("admin.ServiceCtrl",["$scope","ServicePool","$filter",function(e,t){e.$emit("load_start"),e.service_list=t.fetch(function(t){return e.$emit("load_complete"),console.log(t),t}),e.selectedItems=[],e.gridOptions={angridStyle:"th-list",data:"service_list",multiSelectWithCheckbox:!0,columnDefs:[{field:"name",displayName:"Name"},{field:"type",displayName:"Type"},{field:"host",displayName:"Host"},{field:"disabled",displayName:"Disabled"},{field:"region",displayName:"Region"}],selectedItems:e.selectedItems},e.$watch("gridOptions.selectedItems",function(t){e.selectedItems=t})}]),app_module.controller("admin.UserCtrl",["$scope","$filter","UserPool","EventCenter",function(e,t,n,o){e.$emit("load_start"),e.users=n.fetch(function(t){return e.$emit("load_complete"),t}),e.open_create_user=function(){e.is_edit=!1,e.create_user_shown=!0},e.open_confirm_dialog=function(){e.confirm_dialog_shown=!0},e.open_edit_user=function(){e.is_edit=!0,e.create_user_shown=!0},e.delete_users=function(){for(var t=0;e.selectedItems.length>t;t++){var n=e.selectedItems[t];o.trigger("user:remove",n.id)}e.selectedItems.splice(0,e.selectedItems.length)},e.selectedItems=[],e.gridOptions={angridStyle:"th-list",multiSelectWithCheckbox:!0,data:"users",columnDefs:[{field:"name",displayName:"Name"},{field:"email",displayName:"Email"},{field:"enabled",displayName:"Enabled"}],selectedItems:e.selectedItems},e.$watch("gridOptions.selectedItems",function(t){e.selectedItems=t,0!=e.selectedItems.length&&(e.displayItem=e.selectedItems[0])}),e.$on("cache_change:user",function(){e.users=n.fetch()})}]),app_module.controller("admin.VolumeCtrl",["$scope","VolumePool","VolumeTypePool","EventCenter",function(e,t,n,o){e.$emit("load_start"),e.volumes=t.fetch(function(t){return e.$emit("load_complete"),t}),e.selectedItems=[],e.volumegridOptions={angridStyle:"th-list",data:"volumes",multiSelectWithCheckbox:!0,columnDefs:[{field:"tenant_name",displayName:"Project"},{field:"host",displayName:"host"},{field:"name",displayName:"Name"},{field:"size",displayName:"Size"},{field:"abs_status",displayName:"status",columnFilter:"status_icon_filter"},{field:"volume_type",displayName:"Type"},{field:"attachments",displayName:"Attached To",columnFilter:"volume_attach_filter"}],selectedItems:e.selectedItems},e.$watch("volumegridOptions.selectedItems",function(t){e.selectedItems=t}),e.open_confirm_dialog=function(){e.confirm_dialog_shown=!0},e.delete_volumes=function(){angular.forEach(e.selectedItems,function(e){o.trigger("volume:remove",e.id)})},e.volume_types=n.fetch(),e.selectedVT=[],e.volumeTypeGridOptions={angridStyle:"th-list",data:"volume_types",multiSelectWithCheckbox:!0,columnDefs:[{field:"name",displayName:"Name"}],selectedItems:e.selectedVT},e.$watch("volumeTypeGridOptions.selectedItems",function(t){e.selectedVT=t}),e.open_confirm_dialog2=function(){e.confirm_dialog_shown2=!0},e.delete_volume_types=function(){for(var t=0;e.selectedVT.length>t;t++)o.trigger("volume_type:remove",e.selectedVT[t].id)},e.create_vt=function(){e.create_vt_shown=!0},e.$on("cache_change:volume_type",function(){e.volume_types=n.fetch()}),e.$on("cache_change:volume",function(){e.volumes=t.fetch()})}]),app_module.controller("user.BalanceCtrl",["$scope","CrashResource","CouponLogResource",function(e,t,n){var o=(new Date).getFullYear(),a=2011,i=[];e.selected_year=o;for(var r=a;o>=r;r++)i.push(r);e.select_years=i,t.remaining_resource.get(function(t){e.crash_remaining=t.remaining}),n.remaining_resource.get(function(t){e.coupon_remaining=t.remaining}),e.open_load_coupon=function(){e.load_coupon_shown=!0},e.gridOptions={angridStyle:"th-list",data:"coupon_log",columnDefs:[{field:"date",displayName:"Date"},{field:"sn",displayName:"SN"},{field:"value",displayName:"Coupon Value"}]},e.$watch("selected_year",function(t){void 0!==t&&(e.$emit("load_start"),n.list_resource.fetch({year:t},function(t){e.coupon_log=t,e.$emit("load_complete")}))})}]),app_module.controller("user.BillingCtrl",["$scope","CrashResource",function(e,t){var n=(new Date).getFullYear(),o=2011,a=[];e.selected_year=n;for(var i=o;n>=i;i++)a.push(i);e.select_years=a,e.$watch("selected_year",function(n){void 0!==n&&(e.$emit("load_start"),e.crash_log=t.list_resource.fetch({from_cache:1,year:n},function(){e.$emit("load_complete")}))}),e.selectedItems=[],e.gridOptions={angridStyle:"th-list",multiSelectWithCheckbox:!0,data:"crash_log",columnDefs:[{field:"month",displayName:"Month"},{field:"summary",displayName:"Summary"},{field:"instance",displayName:"Instance"},{field:"network",displayName:"Network"},{field:"floating_ip",displayName:"Floating Ip"}],selectedItems:e.selectedItems},e.$watch("gridOptions.selectedItems",function(n){if(e.selectedItems=n,void 0!==n&&1==e.selectedItems.length){var o=e.selectedItems[0].month,a=e.selected_year;t.detail_resource.query({id:a+"-"+o},function(t){e.billing_detail=t})}}),e.detailGridOptions={angridStyle:"th-list",data:"billing_detail",columnDefs:[{field:"resource_name",displayName:"Resource Name"},{field:"resource_type",displayName:"Resource type"},{field:"price",displayName:"Price"},{field:"time_from",displayName:"Start Time"},{field:"time_to",displayName:"End Time"},{field:"money_cost",displayName:"Crash Cost"},{field:"coupon_cost",displayName:"Coupon Cost"},{field:"total_cost",displayName:"Sum"}]}}]),app_module.controller("user.FloatingIpCtrl",["$scope","FloatingIpPool","EventCenter",function(e,t,n){e.$emit("load_start"),e.floating_ips=t.fetch(function(t){return e.$emit("load_complete"),t}),e.open_allocate_ip=function(){e.allocate_ip_shown=!0},e.open_associate_ip=function(){e.associate_ip_shown=!0,e.$broadcast("associate_ip_shown")},e.open_confirm_dialog=function(){e.confirm_dialog_shown=!0},e.open_disassociate_ip=function(){e.disassociate_ip_shown=!0},e.release_ip=function(){for(var t=0;e.selectedItems.length>t;t++){var o=e.selectedItems[t];n.trigger("floating_ip:release",o.id)}e.selectedItems.splice(0,e.selectedItems.length)},e.disassociate_ip=function(){var t=e.selectedItems[0],o={action:"disassociate",instance_uuid:t.instance_id};n.trigger("floating_ip:disassociate",t.id,o)},e.selectedItems=[],e.gridOptions={angridStyle:"th-list",multiSelectWithCheckbox:!0,data:"floating_ips",columnDefs:[{field:"ip",displayName:"IP"},{field:"instance_id",displayName:"Instance Id"},{field:"pool",displayName:"Pool"}],selectedItems:e.selectedItems},e.$watch("gridOptions.selectedItems",function(t){e.selectedItems=t}),e.$on("cache_change:floating_ip",function(){e.floating_ips=t.fetch()})}]),app_module.controller("user.ImageCtrl",["$scope","ImagePool",function(e,t){e.$emit("load_start"),e.images=t.fetch(function(t){return e.$emit("load_complete"),t}),e.open_launch_instance=function(){return 0==e.selectedItems.length?!1:(e.launch_instance_shown=!0,e.$broadcast("launch_instance_with_image",{id:e.selectedItems[0].id}),void 0)},e.selectedItems=[],e.gridOptions={angridStyle:"th-list",data:"images",multiSelectWithCheckbox:!0,columnDefs:[{field:"name",displayName:"Name"},{field:"abs_status",displayName:"Status"},{field:"is_public",displayName:"Public"},{field:"container_format",displayName:"Container Format"}],selectedItems:e.selectedItems},e.gridOptions.columnDefs[1].columnTemplate='<icon keysource="rowData[colData.field]" region="status" ></icon>',e.$watch("gridOptions.selectedItems",function(t){e.selectedItems=t,0!=e.selectedItems.length&&(e.displayItem=e.selectedItems[0])})}]),app_module.controller("user.InstanceCtrl",["$scope","$filter","ApiList","InstancePool","FlavorsResource","combine_instance_flavor","is_dough_enabled","is_loadbalance_enabled","is_kanyun_enabled","EventCenter",function(e,t,n,o,a,i,r,c,s,l){e.$emit("load_start"),e.instances=o.fetch(function(t){return e.$emit("load_complete"),t}),e.launch_instance_shown=!1,e.connect_instance_shown=!1,e.open_launch_instance=function(){e.launch_instance_shown=!0},e.open_connect_instance=function(){e.connect_instance_shown=!0},e.open_edit_instance=function(){e.edit_instance_shown=!0},e.open_console_output=function(){window.open(n.get("instance","console")+e.selectedItems[0].id)},e.open_take_snapshot=function(){e.take_snapshot_shown=!0},e.open_confirm_dialog=function(){e.confirm_dialog_shown=!0},e.delete_instances=function(){angular.forEach(e.selectedItems,function(e){l.trigger("instance:remove",e.id)})},e.action_on_instance=function(t){var n,o=t.type,a=e.selectedItems[0];"toggle_pause"==o?n="paused"==a.status?{action:"unpause"}:{action:"pause"}:"toggle_suspend"==o?n="suspended"==a.status?{action:"resume"}:{action:"suspend"}:"reboot"==o?n={action:"reboot"}:"toggle_stop"==o&&(n="shutoff"==a.status?{action:"start"}:{action:"stop"}),angular.forEach(e.selectedItems,function(e){n.id=e.id,l.trigger("instance:action_on_instance",e.id,n)})},e.check_action_disabled=function(t){var n=t.type;if(0===e.selectedItems.length)return!0;var o=e.selectedItems[0];if(-1!=["building","deleting","transition","error"].indexOf(o.abs_status))return!0;if("reboot"==n)return!1;if(1!=e.selectedItems.length)return!0;if("take_snapshot"==n||"view_log"==n){if("active"!==o.status)return!0}else if("toggle_pause"==n){if(-1==["paused","active"].indexOf(o.status))return!0}else if("toggle_suspend"==n){if(-1==["suspended","active"].indexOf(o.status))return!0}else if("toggle_stop"==n&&-1==["shutoff","active"].indexOf(o.status))return!0;return!1};var u={anGridCopyFn:"copy_text",anGridCopyClass:"ZeroClipboardBtn",anGridCopyInitFn:"copy_init"},d=[{field:"name",displayName:"Name"},{field:"private_ip",displayName:"Private Ip"},{field:"abs_status",displayName:"Status",columnFilter:"status_icon_filter"},{field:"flavor",displayName:"Flavor",columnFilter:"flavor_filter"},{field:"image",displayName:"OS",columnFilter:"distri_filter"},{field:"security_groups",displayName:"Security Groups",columnFilter:"sg_filter"}];c()&&d.push({field:"ssh_domain",displayName:"Public Domain"}),e.selectedItems=[],e.gridOptions={angridStyle:"th-list",multiSelectWithCheckbox:!0,data:"instances",columnDefs:d,selectedItems:e.selectedItems},e[u.anGridCopyInitFn]=function(){window.setTimeout(function(){var e=angular.element("."+u.anGridCopyClass);0!=e.length&&e.each(function(){var e=new ZeroClipboard;e.on("mousedown",function(){angular.element(this).scope(),e.setText(angular.element(this).scope().rowData.ssh_domain),angular.element(this).click()}),e.on("complete",function(e,n){console.log(n.text),alert(t("i18n")("Copy Success"))}),e.glue(angular.element(this))})})},e[u.anGridCopyFn]=function(e){e.stopPropagation()},e.$watch("gridOptions.selectedItems",function(t){e.selectedItems=t,0!=e.selectedItems.length&&(e.displayItem=e.selectedItems[0],e.selected_uuid=e.selectedItems[0].id)}),e.time_ranges=[{value:60,name:"1 hour"},{value:360,name:"6 hours"},{value:1440,name:"1 day"},{value:10080,name:"1 week"}],e.time_range=e.time_ranges[1].value,e.time_periods=[{value:1,name:"1 min"},{value:5,name:"5 mins"},{value:60,name:"60 mins"},{value:360,name:"6 hours"}],e.time_period=e.time_periods[1].value,e.$on("popheight",function(){s()&&(setTimeout(function(){angular.element($("#cpu_chart")).scope().render()},2e3),setTimeout(function(){angular.element($("#blk_read_chart")).scope().render()},2e3),setTimeout(function(){angular.element($("#blk_write_chart")).scope().render()},2e3),setTimeout(function(){angular.element($("#vmnetwork_chart")).scope().render()},2e3),setTimeout(function(){angular.element($("#nic_incoming_chart")).scope().render()},2e3),setTimeout(function(){angular.element($("#nic_outgoing_chart")).scope().render()},2e3))}),e.$on("cache_change:instance",function(){e.instances=o.fetch()})}]),app_module.controller("user.KeypairCtrl",["$scope","KeypairPool","EventCenter",function(e,t,n){e.keypair_modal_shown=!1,e.open_create_keypair_modal=function(){e.keypair_modal_shown=!0,e.import_keypair=!1},e.open_import_keypair_modal=function(){e.keypair_modal_shown=!0,e.import_keypair=!0},e.open_confirm_dialog=function(){e.confirm_dialog_shown=!0},e.delete_keypairs=function(){for(var t=0;e.selectedItems.length>t;t++){var o=e.selectedItems[t];n.trigger("keypair:remove",o.id)}e.selectedItems.splice(0,e.selectedItems.length)},e.$emit("load_start"),e.keypairs=t.fetch(function(t){return e.$emit("load_complete"),t}),e.selectedItems=[],e.gridOptions={angridStyle:"th-list",multiSelectWithCheckbox:!0,data:"keypairs",columnDefs:[{field:"name",displayName:"Name"},{field:"fingerprint",displayName:"Fingerprint"}],selectedItems:e.selectedItems},e.$watch("gridOptions.selectedItems",function(t){e.selectedItems=t}),e.$on("cache_change:keypair",function(){e.keypairs=t.fetch()})}]),app_module.controller("user.LBCtrl",["$scope","LBPool","EventCenter",function(e,t,n){e.open_create_loadbalaner_modal=function(){e.load_balancer_modal_shown=!0,e.edit_load_balancer=!1},e.open_edit_loadbalaner_modal=function(){e.load_balancer_modal_shown=!0,e.edit_load_balancer=!0},e.close_loadbalancer_modal=function(){e.load_balancer_modal_shown=!1},e.open_confirm_dialog=function(){e.confirm_dialog_shown=!0},e.delete_loadbalancer=function(){for(var t=0;e.selectedItems.length>t;t++){var o=e.selectedItems[t];n.trigger("load_balancer:remove",o.id)}},e.$emit("load_start"),e.load_balancers=t.fetch(function(t){return e.$emit("load_complete"),t}),e.selectedItems=[],e.gridOptions={angridStyle:"th-list",multiSelectWithCheckbox:!0,data:"load_balancers",columnDefs:[{field:"name",displayName:"Name"},{field:"abs_status",displayName:"Status",columnFilter:"status_icon_filter"},{field:"protocol",displayName:"Protocol"},{field:"listen_port",displayName:"Listen Port"},{field:"instance_port",displayName:"Instance Port"},{field:"dns_names",displayName:"DNS Domain"}],selectedItems:e.selectedItems},e.$watch("gridOptions.selectedItems",function(t){e.selectedItems=t}),e.$on("cache_change:load_balancer",function(){e.load_balancers=t.fetch()})}]),app_module.controller("user.MonitorCtrl",["$scope","InstancesResource","$filter",function(e,t,n){window.monitor={options:{},unit_map:{cpu:"%",blk_read:"bytes",blk_write:"bytes",nic_outgoing:"bytes",nic_incoming:"bytes",vmnetwork:"bytes"}},e.cpuSourceList=[{value:"demo_CPU"},{value:"default"}],e.products=[{name:"all",type:"all"},{name:"compute",type:"compute"}],e.display_product=e.products[0].type,e.metrics=[{name:"cpu",type:"cpu"},{name:"blk read",type:"blk_read"},{name:"blk write",type:"blk_write"},{name:"vmnetwork",type:"vmnetwork"},{name:"nic incoming",type:"nic_incoming"},{name:"nic outgoing",type:"nic_outgoing"}],e.display_metric=e.metrics[0].type,e.monitor_items=[],e.data_load=!1,e.$emit("load_start"),t.list_resource.fetch({},function(t){e.$emit("load_complete");for(var n=0;t.length>n;n++){var o=t[n];e.monitor_items.push({resource_name:o.name,metrics:e.metrics.map(function(e){return"all"==e.type?null:e.type}),id:o.id})}e.all_monitor_items=e.monitor_items,e.data_load=!0}),e.gridOptions={angridStyle:"th-list",multiSelectWithCheckbox:!0,data:"monitor_items",columnDefs:[{field:"resource_name",displayName:"Resource"},{field:"metrics",displayName:"Metrics",columnTemplete:n("moniter_metrics_format")()}],selectedItems:e.selectedItems},e.statistic_methods=["avg","sum","max","min"],e.statistic_method=e.statistic_methods[0],e.time_ranges=[60,360,1440,10080],e.time_range=e.time_ranges[0],e.time_periods=[1,5,60,360],e.time_period=e.time_periods[1],e.$on("metric selected",function(t,n,o){e.selectedItems=[n],e.selected_uuid=n.id,e.current_metric=o,window.monitor.options.id=n.id,window.monitor.options.metric=o,window.monitor.options.unit=window.monitor.unit_map[o]})}]),app_module.controller("user.OverviewCtrl",["$scope","$filter","$cookies","init_quotas","get_instance_quotas","combine_instance_flavor","is_loadbalance_enabled","QuotaPool","FlavorPool","InstancePool","VolumePool","SgPool","KeypairPool","FloatingIpPool","SnapshotPool","LBPool","ProjectUsagePool",function(e,t,n,o,a,i,r,c,s,l,u,d,p,m,f,_,h){var g=["instances","cores","gigabytes","ram","floating_ips","key_pairs","snapshots","security_groups"];r()&&g.push("load_balancers"),e.open_launch_instance=function(){e.launch_instance_shown=!0},c.fetch(function(i){e.quotas=o(g,i),s.fetch(function(t){e.flavors=t,l.fetch(function(t){h.get({id:n.project_id},function(n){var o=[];angular.forEach(t,function(e){var t=n.server_usages[e.id];e.uptime=t.uptime,e.memory_mb=t.memory_mb,e.hours=t.hours,e.vcpus=t.vcpus,e.local_gb=t.local_gb,this.push(e)},o),e.instances=o}),e.quotas=a(e.quotas,t)})}),u.fetch(function(n){var o=0;t("gb_format");for(var a=0;n.length>a;a++)o+=n[a].size;e.quotas.gigabytes.raw_used=o}),d.fetch(function(t){e.quotas.security_groups.raw_used=t.length}),p.fetch(function(t){e.quotas.key_pairs.raw_used=t.length}),m.fetch(function(t){e.quotas.floating_ips.raw_used=t.length}),f.fetch(function(t){e.quotas.snapshots.raw_used=t.length}),r()&&_.fetch(function(t){e.quotas.load_balancers.raw_used=t.length})}),e.$on("cache_change:instance",function(){e.instances=l.fetch()})}]),app_module.controller("user.SgCtrl",["$scope","SgPool","EventCenter",function(e,t,n){e.sg_modal_shown=!1,e.open_create_sg_modal=function(){e.sg_modal_shown=!0,e.update_sg=!1},e.open_update_sg_modal=function(){e.sg_modal_shown=!0,e.update_sg=!0},e.open_confirm_dialog=function(){e.confirm_dialog_shown=!0},e.delete_group=function(){for(var t=0;e.selectedItems.length>t;t++){var o=e.selectedItems[t];n.trigger("sg:remove",o.id)}e.selectedItems.splice(0,e.selectedItems.length)},e.$emit("load_start"),e.security_groups=t.fetch(function(t){return e.$emit("load_complete"),t}),e.selectedItems=[],e.gridOptions={angridStyle:"th-list",multiSelectWithCheckbox:!0,data:"security_groups",columnDefs:[{field:"name",displayName:"Name"},{field:"description",displayName:"Description"}],selectedItems:e.selectedItems},e.$watch("gridOptions.selectedItems",function(t){e.selectedItems=t}),e.$on("cache_change:sg",function(){e.security_groups=t.fetch()})}]),app_module.controller("user.SnapshotCtrl",["$scope","SnapshotPool","EventCenter",function(e,t,n){e.$emit("load_start"),e.snapshots=t.fetch(function(t){return e.$emit("load_complete"),t}),e.open_launch_instance=function(){e.launch_instance_shown=!0,e.$broadcast("launch_instance_with_snapshot",{id:e.selectedItems[0].id})},e.open_confirm_dialog=function(){e.confirm_dialog_shown=!0},e.delete_snapshots=function(){for(var t=0;e.selectedItems.length>t;t++)n.trigger("snapshot:remove",e.selectedItems[t].id)},e.update_snapshot=function(){e.update_snapshot_shown=!0,e.$broadcast("update_snapshot_shown")},e.selectedItems=[],e.gridOptions={angridStyle:"th-list",multiSelectWithCheckbox:!0,data:"snapshots",columnDefs:[{field:"name",displayName:"Name"},{field:"abs_status",displayName:"Status",columnFilter:"status_icon_filter"},{field:"is_public",displayName:"Public"},{field:"container_format",displayName:"Container Format"}],selectedItems:e.selectedItems},e.gridOptions.columnDefs[1].columnTemplate='<icon keysource="rowData[colData.field]" region="status" ></icon>',e.$watch("gridOptions.selectedItems",function(t){e.selectedItems=t,0!=e.selectedItems.length&&(e.displayItem=e.selectedItems[0])}),e.displayItem={},e.$on("cache_change:snapshot",function(){e.snapshots=t.fetch()})}]),app_module.controller("user.VolumeCtrl",["$scope","InstancePool","VolumePool","EventCenter",function(e,t,n,o){e.$emit("load_start"),t.fetch(),e.volumes=n.fetch(function(t){return e.$emit("load_complete"),t}),e.selectedItems=[],e.gridOptions={angridStyle:"th-list",data:"volumes",multiSelectWithCheckbox:!0,columnDefs:[{field:"name",displayName:"Name"},{field:"description",displayName:"Description"},{field:"size",displayName:"Size"},{field:"abs_status",displayName:"Status",columnFilter:"status_icon_filter"},{field:"volume_type",displayName:"Type"},{field:"attachments",displayName:"Attached To",columnFilter:"volume_attach_filter"}],selectedItems:e.selectedItems},e.$watch("gridOptions.selectedItems",function(t){e.selectedItems=t}),e.open_create_volume_modal=function(){e.create_volume_shown=!0},e.open_confirm_dialog=function(){e.confirm_dialog_shown=!0},e.open_edit_attachment_modal=function(){var t=e.selectedItems[0];0==t.attachments.length?e.edit_attachment_shown=!0:e.edit_detachment_shown=!0},e.open_create_snapshot_modal=function(){e.create_volume_snapshot_shown=!0},e.delete_volumes=function(){for(var t=0;e.selectedItems.length>t;t++)o.trigger("volume:remove",e.selectedItems[t].id)},e.$on("cache_change:volume",function(){e.volumes=n.fetch()})}]),app_module.controller("user.VolumeSnapshotCtrl",["$scope","VolumeSnapshotPool","EventCenter",function(e,t,n){e.$emit("load_start"),e.volume_snapshots=t.fetch(function(t){return e.$emit("load_complete"),t}),e.selectedItems=[],e.gridOptions={angridStyle:"th-list",data:"volume_snapshots",multiSelectWithCheckbox:!0,columnDefs:[{field:"name",displayName:"Name"},{field:"description",displayName:"Description"},{field:"size",displayName:"Size"},{field:"abs_status",displayName:"Status",columnFilter:"status_icon_filter"},{field:"volume_name",displayName:"Volume Name"}],selectedItems:e.selectedItems},e.$watch("gridOptions.selectedItems",function(t){e.selectedItems=t}),e.open_confirm_dialog=function(){e.confirm_dialog_shown=!0},e.open_create_volume_modal=function(){e.create_volume_shown=!0},e.delete_volume_snapshots=function(){for(var t=0;e.selectedItems.length>t;t++)n.trigger("volume_snapshot:remove",e.selectedItems[t].id)},e.$on("cache_change:volume_snapshot",function(){e.volume_snapshots=t.fetch()})}]);